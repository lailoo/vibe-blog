# Redis å¿«é€Ÿä¸Šæ‰‹å®æˆ˜æŒ‡å—ï¼šä»å®‰è£…åˆ°æ ¸å¿ƒæ•°æ®ç»“æ„æ“ä½œ


![Redis å¿«é€Ÿä¸Šæ‰‹å®æˆ˜æŒ‡å—ï¼šä»å®‰è£…åˆ°æ ¸å¿ƒæ•°æ®ç»“æ„æ“ä½œ - æ¶æ„å›¾](./images/194a488c342c484295137b404437c597.jpg)

*Redis å¿«é€Ÿä¸Šæ‰‹å®æˆ˜æŒ‡å—ï¼šä»å®‰è£…åˆ°æ ¸å¿ƒæ•°æ®ç»“æ„æ“ä½œ - ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ*


---


## Rediså…¥é—¨æ•™ç¨‹ - å†…å­˜æ•°æ®åº“ã€ç¼“å­˜ç³»ç»Ÿã€å­—ç¬¦ä¸²ã€å“ˆå¸Œã€åˆ—è¡¨ã€é›†åˆã€æœ‰åºé›†åˆ

**é˜…è¯»æ—¶é—´**: 30 min

> 30åˆ†é’ŸæŒæ¡ Redis æ ¸å¿ƒæ•°æ®ç»“æ„å®æˆ˜æŠ€èƒ½ï¼Œä¸ºé«˜å¹¶å‘é¡¹ç›®æ‰“ä¸‹åšå®åŸºç¡€ã€‚

## ç›®å½•

- [Redis æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆä½ éœ€è¦å®ƒ](#redis-æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆä½ éœ€è¦å®ƒ)
- [ç¯å¢ƒå‡†å¤‡ï¼šæœ¬åœ°å®‰è£…ä¸è¿æ¥æµ‹è¯•](#ç¯å¢ƒå‡†å¤‡æœ¬åœ°å®‰è£…ä¸è¿æ¥æµ‹è¯•)
- [å®æˆ˜æ¼”ç»ƒï¼šäº”å¤§æ ¸å¿ƒæ•°æ®ç»“æ„é€ä¸ªå‡»ç ´](#å®æˆ˜æ¼”ç»ƒäº”å¤§æ ¸å¿ƒæ•°æ®ç»“æ„é€ä¸ªå‡»ç ´)
- [åŠŸèƒ½éªŒè¯ï¼šæ¨¡æ‹ŸçœŸå®åœºæ™¯æµ‹è¯•æ•°æ®æ“ä½œ](#åŠŸèƒ½éªŒè¯æ¨¡æ‹ŸçœŸå®åœºæ™¯æµ‹è¯•æ•°æ®æ“ä½œ)
- [æ€»ç»“ä¸è¿›é˜¶è·¯çº¿](#æ€»ç»“ä¸è¿›é˜¶è·¯çº¿)


---


åœ¨ç°ä»£é«˜å¹¶å‘åº”ç”¨ä¸­ï¼Œå¿«é€Ÿè¯»å†™èƒ½åŠ›æ˜¯æ€§èƒ½ç“¶é¢ˆçš„å…³é”®çªç ´å£ã€‚Redis ä½œä¸ºä¸€æ¬¾åŸºäºå†…å­˜çš„é«˜æ€§èƒ½æ•°æ®ç»“æ„å­˜å‚¨ç³»ç»Ÿï¼Œè¢«å¹¿æ³›ç”¨äºç¼“å­˜ã€ä¼šè¯ç®¡ç†ã€æ’è¡Œæ¦œç­‰åœºæ™¯ã€‚æœ¬æ–‡é¢å‘ä¸­çº§å¼€å‘è€…ï¼Œå¸¦ä½ ä»é›¶æ­å»º Redis ç¯å¢ƒï¼Œå¹¶äº²æ‰‹æ“ä½œäº”ç§æ ¸å¿ƒæ•°æ®ç»“æ„ï¼ŒæŒæ¡å…¶å…¸å‹åº”ç”¨åœºæ™¯ä¸å‘½ä»¤ç”¨æ³•ã€‚


---


## Redis æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆä½ éœ€è¦å®ƒ

ä½ æ˜¯å¦é‡åˆ°è¿‡è¿™æ ·çš„åœºæ™¯ï¼šç”¨æˆ·ç–¯ç‹‚ç‚¹å‡»â€œæŠ¢è´­â€æŒ‰é’®ï¼Œç³»ç»Ÿå´å¡é¡¿å¦‚èœ—ç‰›ï¼›æˆ–è€…åå°ç»Ÿè®¡æŠ¥è¡¨åŠ è½½ç¼“æ…¢ï¼Œè€æ¿åœ¨èº«åçš±çœ‰å‚¬ä¿ƒï¼Ÿæƒ³è±¡ä¸€ä¸‹ï¼Œçº¿ä¸Šçªç„¶æ¶Œå…¥åä¸‡å¹¶å‘è¯·æ±‚â€”â€”æ•°æ®åº“ç›´æ¥ç˜«ç—ªï¼Œé¡µé¢ä¸€ç‰‡502ï¼Œå®¢æœç”µè¯è¢«æ‰“çˆ†ã€‚è¿™ä¸æ˜¯æ¼”ä¹ ï¼Œè€Œæ˜¯æ— æ•°äº’è”ç½‘äº§å“çœŸå®ç»å†è¿‡çš„â€œè‡³æš—æ—¶åˆ»â€ã€‚è€Œ90%çš„æ€§èƒ½ç“¶é¢ˆï¼Œæ ¹æºéƒ½å‡ºåœ¨æ•°æ®è¯»å†™å±‚ã€‚è¿™æ—¶å€™ï¼Œä½ éœ€è¦çš„ä¸æ˜¯æ›´è´µçš„æœåŠ¡å™¨ï¼Œè€Œæ˜¯ä¸€ä¸ªèªæ˜ã€è¿…æ·ã€å¯é çš„â€œæ•°æ®åŠ é€Ÿå™¨â€â€”â€”Redisã€‚

> Redis ä¸åªæ˜¯ç¼“å­˜â€”â€”å®ƒæ˜¯ä½ åº”å¯¹é«˜å¹¶å‘çš„ç‘å£«å†›åˆ€ã€‚

### ä»€ä¹ˆæ˜¯ Redisï¼Ÿå†…å­˜ä¸­çš„å¤šé¢æ‰‹

Redisï¼ˆRemote Dictionary Serverï¼‰æ˜¯ä¸€æ¬¾å¼€æºã€åŸºäºå†…å­˜ã€æ”¯æŒå¤šç§æ•°æ®ç»“æ„çš„é«˜æ€§èƒ½é”®å€¼å­˜å‚¨ç³»ç»Ÿã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªè¿è¡Œåœ¨å†…å­˜é‡Œçš„â€œè¶…çº§å­—å…¸â€ï¼Œä½†å®ƒè¿œä¸æ­¢æ˜¯ç®€å•çš„ key-value æ˜ å°„ã€‚å®ƒåŸç”Ÿæ”¯æŒå­—ç¬¦ä¸²ï¼ˆStringï¼‰ã€å“ˆå¸Œï¼ˆHashï¼‰ã€åˆ—è¡¨ï¼ˆListï¼‰ã€é›†åˆï¼ˆSetï¼‰ã€æœ‰åºé›†åˆï¼ˆSorted Setï¼‰ç­‰äº”å¤§æ•°æ®ç»“æ„ï¼Œè®©ä½ èƒ½åƒæ“ä½œæœ¬åœ°æ•°æ®ç»“æ„ä¸€æ ·çµæ´»åœ°å¤„ç†è¿œç¨‹æ•°æ®ã€‚

ä¸ä¼ ç»Ÿç£ç›˜æ•°æ®åº“ä¸åŒï¼ŒRedis å°†æ•°æ®ä¼˜å…ˆå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œè¿™å¸¦æ¥äº†æƒŠäººçš„é€Ÿåº¦ä¼˜åŠ¿â€”â€”å•å®ä¾‹å³å¯è½»æ¾æ”¯æ’‘æ¯ç§’10ä¸‡+æ¬¡è¯»å†™æ“ä½œï¼Œå“åº”æ—¶é—´ç¨³å®šåœ¨æ¯«ç§’çº§ã€‚å½“ç„¶ï¼Œå†…å­˜æ˜“å¤±ï¼Ÿåˆ«æ‹…å¿ƒï¼ŒRedis æä¾›äº† RDB å¿«ç…§å’Œ AOF æ—¥å¿—ä¸¤ç§æŒä¹…åŒ–æœºåˆ¶ï¼Œç¡®ä¿æ•°æ®å®‰å…¨ä¸ä¸¢å¤±ã€‚å®ƒå°±åƒä¸€è¾†æ³•æ‹‰åˆ©è·‘è½¦ï¼Œæ—¢è¿½æ±‚æè‡´é€Ÿåº¦ï¼Œåˆé…å¤‡äº†å…¨å¥—å®‰å…¨æ°”å›Šã€‚

```mermaid
flowchart LR
    subgraph å®¢æˆ·ç«¯å±‚
        A[ç”¨æˆ·ç‚¹å‡»æŠ¢è´­/æŠ¥è¡¨è¯·æ±‚]
    end
    subgraph Redisæ ¸å¿ƒå±‚
        B[Redis Server]
        C[å†…å­˜å­˜å‚¨ - æ¯«ç§’å“åº”]
        D[RDBå¿«ç…§ + AOFæ—¥å¿—]
    end
    subgraph åº”ç”¨ç³»ç»Ÿå±‚
        E[åº”ç”¨æœåŠ¡ - å¦‚ç”µå•†/ç»Ÿè®¡ç³»ç»Ÿ]
    end
    A --> B
    B --> C
    C --> D
    B --> E
    style C fill:#e6f7ff,stroke:#1890ff
    style D fill:#f6ffed,stroke:#52c41a
```

*Redisæ¶æ„ç¤ºæ„å›¾ï¼šå®¢æˆ·ç«¯è¯·æ±‚ç»ç”±Rediså†…å­˜é«˜é€Ÿå¤„ç†ä¸æŒä¹…åŒ–ä¿éšœï¼Œæœ€ç»ˆæœåŠ¡äºåº”ç”¨ç³»ç»Ÿ*

### ä¸‰å¤§è§’è‰²ï¼šæ•°æ®åº“ã€ç¼“å­˜ã€æ¶ˆæ¯ä¸­é—´ä»¶

Redis çš„é­…åŠ›åœ¨äºå®ƒçš„â€œå¤šè§’è‰²æ‰®æ¼”èƒ½åŠ›â€ã€‚å®ƒä¸åªæ˜¯ä¸€ä¸ªç¼“å­˜å·¥å…·ï¼Œè€Œæ˜¯ç°ä»£æ¶æ„ä¸­ä¸å¯æˆ–ç¼ºçš„â€œä¸‰åˆä¸€ç¥å™¨â€ã€‚

é¦–å…ˆï¼Œä½œä¸º**æ•°æ®åº“**ï¼ŒRedis èƒ½èƒœä»»éœ€è¦é«˜é€Ÿè¯»å†™çš„åœºæ™¯ï¼Œæ¯”å¦‚å®æ—¶æ’è¡Œæ¦œã€åœ¨çº¿ç”¨æˆ·çŠ¶æ€ã€é…ç½®ä¸­å¿ƒç­‰ã€‚å…¶æ¬¡ï¼Œä½œä¸º**ç¼“å­˜å±‚**ï¼Œå®ƒæŒ¡åœ¨åº”ç”¨ä¸æ…¢é€Ÿæ•°æ®åº“ä¹‹é—´ï¼Œå°†çƒ­ç‚¹æ•°æ®ç¼“å­˜åœ¨å†…å­˜ï¼Œæå¤§ç¼“è§£åç«¯å‹åŠ›ã€‚æœ€åï¼Œå€ŸåŠ© List æˆ– Stream æ•°æ®ç»“æ„ï¼ŒRedis è¿˜èƒ½å……å½“è½»é‡çº§**æ¶ˆæ¯é˜Ÿåˆ—**ï¼Œå®ç°æœåŠ¡è§£è€¦ä¸å¼‚æ­¥å¤„ç†ã€‚

è¿™ç§ä¸‰ä½ä¸€ä½“çš„èƒ½åŠ›ï¼Œè®© Redis æˆä¸ºå¾®æœåŠ¡æ¶æ„ã€é«˜å¹¶å‘ç³»ç»Ÿã€å®æ—¶åˆ†æå¹³å°çš„é¦–é€‰ç»„ä»¶ã€‚æ— è®ºä½ æ˜¯è¦æ„å»ºç”µå•†ç§’æ€ç³»ç»Ÿï¼Œè¿˜æ˜¯æ¸¸æˆå®æ—¶å¯¹æˆ˜åŒ¹é…ï¼ŒRedis éƒ½èƒ½æä¾›åº•å±‚æ”¯æ’‘ã€‚

### å…¸å‹åº”ç”¨åœºæ™¯ï¼šä»ä¼šè¯åˆ°æ’è¡Œæ¦œï¼Œæ— æ‰€ä¸èƒ½

è®©æˆ‘ä»¬çœ‹çœ‹ Redis åœ¨çœŸå®ä¸–ç•Œä¸­çš„â€œæˆ˜ç»©â€ï¼š

- **ä¼šè¯ç¼“å­˜ï¼ˆSession Cacheï¼‰**ï¼šç”¨æˆ·çš„ç™»å½•çŠ¶æ€ã€è´­ç‰©è½¦å†…å®¹ç­‰ä¸´æ—¶æ•°æ®ï¼Œå­˜å…¥ Redis å¯å®ç°è·¨æœåŠ¡å…±äº«ä¸å¿«é€Ÿè®¿é—®ï¼Œé¿å…åå¤æŸ¥è¯¢æ•°æ®åº“ã€‚
- **å®æ—¶æ’è¡Œæ¦œï¼ˆLeaderboardï¼‰**ï¼šåˆ©ç”¨ Sorted Set æ•°æ®ç»“æ„ï¼Œè½»æ¾å®ç°å®æ—¶åˆ†æ•°æ’åï¼Œæ¯”å¦‚æ¸¸æˆç§¯åˆ†æ¦œã€ç›´æ’­äººæ°”æ¦œï¼Œæ’å…¥ä¸æŸ¥è¯¢å¤æ‚åº¦å‡ä¸º O(log N)ã€‚
- **è®¡æ•°å™¨ï¼ˆCounterï¼‰**ï¼šæ–‡ç« é˜…è¯»æ•°ã€å•†å“åº“å­˜ã€æ¥å£é™æµè®¡æ•°ç­‰é«˜é¢‘æ›´æ–°åœºæ™¯ï¼ŒRedis çš„åŸå­æ“ä½œï¼ˆINCR/DECRï¼‰ç¡®ä¿çº¿ç¨‹å®‰å…¨ä¸æè‡´æ€§èƒ½ã€‚
- **æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessage Queueï¼‰**ï¼šé€šè¿‡ LPUSH/RPOP æˆ–æ›´ç°ä»£çš„ Stream ç»“æ„ï¼Œå®ç°ä»»åŠ¡åˆ†å‘ã€æ—¥å¿—æ”¶é›†ã€äº‹ä»¶é€šçŸ¥ç­‰å¼‚æ­¥é€šä¿¡éœ€æ±‚ã€‚

ä¸¾ä¸ªä¾‹å­ï¼šæŸç”µå•†å¹³å°å¤§ä¿ƒæœŸé—´ï¼Œå•†å“è¯¦æƒ…é¡µ QPS è¾¾åˆ° 5 ä¸‡ï¼Œè‹¥æ¯æ¬¡è¯·æ±‚éƒ½æŸ¥ MySQLï¼Œæ•°æ®åº“å¿…ç„¶å´©æºƒã€‚å¼•å…¥ Redis ç¼“å­˜å•†å“ä¿¡æ¯åï¼Œ90% çš„è¯·æ±‚è¢«å†…å­˜å“åº”ï¼Œæ•°æ®åº“è´Ÿè½½ä¸‹é™ 80%ï¼Œç”¨æˆ·ä½“éªŒä¸æ»‘å¦‚åˆã€‚

> âš ï¸ æ³¨æ„: Redis è™½å¿«ï¼Œä½†å†…å­˜æœ‰é™ï¼ŒåŠ¡å¿…åˆç†è®¾ç½®è¿‡æœŸç­–ç•¥ï¼ˆTTLï¼‰å’Œæ·˜æ±°æœºåˆ¶ï¼ˆå¦‚ LRUï¼‰ï¼Œé¿å…å†…å­˜æº¢å‡ºå¯¼è‡´æœåŠ¡å®•æœºã€‚


---


æ— è®ºä½ æ˜¯åç«¯å·¥ç¨‹å¸ˆã€æ¶æ„å¸ˆï¼Œè¿˜æ˜¯è¿ç»´äººå‘˜ï¼ŒæŒæ¡ Redis éƒ½å°†æˆä¸ºä½ æŠ€æœ¯æ­¦å™¨åº“ä¸­çš„å…³é”®ä¸€ç¯ã€‚å®ƒä¸ä»…è§£å†³æ€§èƒ½é—®é¢˜ï¼Œæ›´èƒ½é‡å¡‘ç³»ç»Ÿè®¾è®¡æ€ç»´â€”â€”ä»â€œèƒ½ä¸èƒ½è·‘â€å‡çº§åˆ°â€œè·‘å¾—æœ‰å¤šå¿«ã€æœ‰å¤šç¨³â€ã€‚

ä¸‹ä¸€ç« èŠ‚ã€Šç¯å¢ƒå‡†å¤‡ï¼šæœ¬åœ°å®‰è£…ä¸è¿æ¥æµ‹è¯•ã€‹å°†æ‰‹æŠŠæ‰‹å¸¦ä½ æ­å»º Redis ç¯å¢ƒï¼Œå¹¶é€šè¿‡ CLI å®Œæˆé¦–æ¬¡äº¤äº’ï¼Œè¿ˆå‡ºå®æˆ˜ç¬¬ä¸€æ­¥ã€‚


---


## ç¯å¢ƒå‡†å¤‡ï¼šæœ¬åœ°å®‰è£…ä¸è¿æ¥æµ‹è¯•

ä½ æ˜¯å¦é‡åˆ°è¿‡è¿™æ ·çš„æƒ…å†µï¼šå…´è‡´å‹ƒå‹ƒæƒ³å­¦ä¹ ä¸€ä¸ªæ–°æŠ€æœ¯ï¼Œç»“æœå¡åœ¨ç¯å¢ƒé…ç½®ä¸Šæ•´æ•´ä¸€ä¸‹åˆï¼Ÿå‘½ä»¤æŠ¥é”™ã€è·¯å¾„ä¸å¯¹ã€ç«¯å£å†²çªâ€¦â€¦æœ€åçƒ­æƒ…è¢«æ¶ˆç£¨æ®†å°½ï¼Œé¡¹ç›®èƒæ­»è…¹ä¸­ã€‚æ®å¼€å‘è€…ç¤¾åŒºç»Ÿè®¡ï¼Œ**90% çš„åˆå­¦è€…æ”¾å¼ƒ Redis å­¦ä¹ ï¼Œå¹¶éå› ä¸ºæ¦‚å¿µéš¾æ‡‚ï¼Œè€Œæ˜¯å€’åœ¨äº†â€œç¬¬ä¸€æ­¥æ²¡è·‘é€šâ€çš„é—¨æ§›å‰**ã€‚

æƒ³è±¡ä¸€ä¸‹ï¼Œå½“ä½ åœ¨çº¿ä¸Šç³»ç»Ÿçªå‘ç¼“å­˜é›ªå´©ï¼Œæ€¥éœ€æœ¬åœ°å¿«é€Ÿå¤ç°é—®é¢˜æ—¶ï¼Œå´å‘ç° Redis æœåŠ¡æ ¹æœ¬å¯åŠ¨ä¸äº†â€”â€”é‚£ç§æŠ“ç‹‚æ„Ÿè¶³ä»¥è®©ä»»ä½•å·¥ç¨‹å¸ˆè¡€å‹é£™å‡ã€‚æ‰€ä»¥ï¼Œæœ¬ç« æˆ‘ä»¬ä¸è°ˆé«˜æ·±ç†è®ºï¼Œåªèšç„¦ä¸€ä»¶äº‹ï¼š**è®©ä½ çš„ Redis åœ¨æœ¬åœ°ç¨³ç¨³è·‘èµ·æ¥ï¼Œ5 åˆ†é’Ÿå†…å®Œæˆä»é›¶åˆ° PONG çš„èƒœåˆ©é—­ç¯**ã€‚ç¯å¢ƒè·‘é€šæ˜¯æˆåŠŸçš„ç¬¬ä¸€æ­¥ â€”â€” åˆ«è®©é…ç½®æ‹¦ä½ä½ çš„å­¦ä¹ çƒ­æƒ…ã€‚


---


### ä¸ºä»€ä¹ˆæ¨è Docker ä¸€é”®éƒ¨ç½²ï¼Ÿ

åœ¨ä¼ ç»Ÿå®‰è£…æ–¹å¼ä¸­ï¼Œä¸åŒæ“ä½œç³»ç»Ÿï¼ˆMac/Windows/Linuxï¼‰çš„ä¾èµ–ã€ç¼–è¯‘ã€æƒé™è®¾ç½®åƒå·®ä¸‡åˆ«ï¼Œå…‰æ˜¯è§£å†³â€œlibssl.so.1.1 not foundâ€è¿™ç±»æŠ¥é”™å°±èƒ½è€—æ‰åŠå¤©ã€‚è€Œä½¿ç”¨ Dockerï¼Œä½ åªéœ€ä¸€æ¡å‘½ä»¤ï¼Œå³å¯è·å¾—å®˜æ–¹ç»´æŠ¤ã€ç‰ˆæœ¬ç¨³å®šã€éš”ç¦»å¹²å‡€çš„ Redis å®ä¾‹ã€‚è¿™å°±åƒç‚¹å¤–å– vs è‡ªå·±ä¸‹å¨â€”â€”å‰è€…çœæ—¶çœåŠ›ï¼Œåè€…è™½è‡ªç”±ä½†å®¹æ˜“ç¿»è½¦ã€‚

> âš ï¸ æ³¨æ„: å¦‚æœä½ å°šæœªå®‰è£… Dockerï¼Œè¯·å…ˆå‰å¾€ [Docker å®˜ç½‘](https://www.docker.com/) ä¸‹è½½å¯¹åº”ç³»ç»Ÿçš„ Desktop ç‰ˆæœ¬å¹¶å®Œæˆåˆå§‹åŒ–ã€‚ç¡®è®¤ `docker --version` èƒ½æ­£å¸¸è¾“å‡ºå³è¡¨ç¤ºå‡†å¤‡å°±ç»ªã€‚

```mermaid
flowchart LR
    A[ä¸‹è½½ Redis é•œåƒ] --> B[å¯åŠ¨ Docker å®¹å™¨]
    B --> C[è¿æ¥ redis-cli]
    C --> D[å‘é€ PING å‘½ä»¤]
    D --> E[æ”¶åˆ° PONG å“åº”]
```

*Redis æœ¬åœ°å®‰è£…ä¸è¿æ¥æµ‹è¯•äº”æ­¥é—­ç¯æµç¨‹ï¼šä»é•œåƒä¸‹è½½åˆ°æˆåŠŸå“åº” PONG*


---


### ä¸‰å¹³å°å®‰è£…å‘½ä»¤ç¤ºä¾‹

æ— è®ºä½ ç”¨çš„æ˜¯ Macã€Windows è¿˜æ˜¯ Linuxï¼ŒDocker éƒ½ä¸ºä½ æŠ¹å¹³äº†å·®å¼‚ã€‚ä»¥ä¸‹æ˜¯å„å¹³å°å¯åŠ¨ Redis çš„ç»Ÿä¸€å‘½ä»¤ï¼š

```python
import subprocess
import time
import redis
from typing import Optional, Dict, Any

def start_redis_docker_container(container_name: str = 'my-redis', port: int = 6379) -> bool:
    """
    å¯åŠ¨ Redis Docker å®¹å™¨å¹¶ç­‰å¾…å…¶å°±ç»ªã€‚
    
    Args:
        container_name (str): å®¹å™¨åç§°ï¼Œé»˜è®¤ä¸º 'my-redis'
        port (int): ä¸»æœºæ˜ å°„ç«¯å£ï¼Œé»˜è®¤ä¸º 6379
    
    Returns:
        bool: å¯åŠ¨æˆåŠŸè¿”å› Trueï¼Œå¤±è´¥è¿”å› False
    """
    # Step 1: æ£€æŸ¥å®¹å™¨æ˜¯å¦å·²å­˜åœ¨å¹¶è¿è¡Œ
    try:
        result = subprocess.run(
            ['docker', 'ps', '-q', '-f', f'name={container_name}'],
            capture_output=True,
            text=True,
            check=True
        )
        if result.stdout.strip():
            print(f"[INFO] Container '{container_name}' is already running.")
            return True
    except subprocess.CalledProcessError as e:
        print(f"[ERROR] Failed to check container status: {e}")
        return False

    # Step 2: å¦‚æœå®¹å™¨æœªè¿è¡Œï¼Œåˆ™å°è¯•å¯åŠ¨æ–°å®¹å™¨
    try:
        print(f"[INFO] Starting Redis container '{container_name}' on port {port}...")
        subprocess.run(
            [
                'docker', 'run', '-d',
                '--name', container_name,
                '-p', f'{port}:6379',
                'redis:latest',
                'redis-server', '--appendonly', 'yes'
            ],
            check=True,
            capture_output=True,
            text=True
        )
        print(f"[SUCCESS] Redis container '{container_name}' started successfully.")
    except subprocess.CalledProcessError as e:
        print(f"[ERROR] Failed to start Redis container: {e.stderr}")
        return False

    # Step 3: ç­‰å¾…å®¹å™¨åˆå§‹åŒ–å®Œæˆï¼ˆæœ€å¤šç­‰å¾…30ç§’ï¼‰
    max_wait = 30
    for i in range(max_wait):
        try:
            client = redis.Redis(host='localhost', port=port, db=0, socket_connect_timeout=1)
            client.ping()  # å°è¯•è¿æ¥å¹¶ ping
            print(f"[SUCCESS] Redis server ready after {i + 1} seconds.")
            return True
        except redis.ConnectionError:
            print(f"[WAITING] Redis not ready yet... ({i + 1}/{max_wait} seconds)")
            time.sleep(1)
    
    print("[ERROR] Redis server failed to start within timeout.")
    return False

def test_redis_connection(port: int = 6379) -> Optional[Dict[str, Any]]:
    """
    æµ‹è¯•ä¸æœ¬åœ° Redis æœåŠ¡çš„è¿æ¥å¹¶è¿”å›æœåŠ¡å™¨ä¿¡æ¯ã€‚
    
    Args:
        port (int): Redis æœåŠ¡ç«¯å£ï¼Œé»˜è®¤ä¸º 6379
    
    Returns:
        Optional[Dict]: æˆåŠŸæ—¶è¿”å› Redis info å­—å…¸ï¼Œå¤±è´¥è¿”å› None
    """
    # Step 1: åˆ›å»º Redis å®¢æˆ·ç«¯è¿æ¥
    try:
        client = redis.Redis(host='localhost', port=port, db=0, socket_timeout=5)
        
        # Step 2: Ping æµ‹è¯•è¿é€šæ€§
        pong = client.ping()
        if not pong:
            print("[ERROR] Redis ping failed.")
            return None
        
        # Step 3: è·å– Redis æœåŠ¡å™¨ä¿¡æ¯
        info = client.info()
        print(f"[SUCCESS] Connected to Redis server v{info.get('redis_version')}")
        return info
        
    except redis.ConnectionError as e:
        print(f"[ERROR] Connection failed: {e}")
        return None
    except Exception as e:
        print(f"[ERROR] Unexpected error: {e}")
        return None

# Step 4: ä¸»æ‰§è¡Œé€»è¾‘ â€”â€” å¯åŠ¨å®¹å™¨å¹¶æµ‹è¯•è¿æ¥

if __name__ == "__main__":
    # Step 5: å¯åŠ¨ Redis Docker å®¹å™¨
    if start_redis_docker_container(container_name='test-redis', port=6380):
        # Step 6: æµ‹è¯•è¿æ¥
        redis_info = test_redis_connection(port=6380)
        if redis_info:
            print("
=== Redis Server Info ===")
            print(f"Version: {redis_info.get('redis_version', 'N/A')}")
            print(f"Uptime: {redis_info.get('uptime_in_seconds', 'N/A')} seconds")
            print(f"Connected Clients: {redis_info.get('connected_clients', 'N/A')}")
        else:
            print("[FAILURE] Could not retrieve Redis info.")
    else:
        print("[FAILURE] Redis container failed to start.")
```

#### OUTPUT

```
[INFO] Starting Redis container 'test-redis' on port 6380...
[SUCCESS] Redis container 'test-redis' started successfully.
[WAITING] Redis not ready yet... (1/30 seconds)
[WAITING] Redis not ready yet... (2/30 seconds)
[SUCCESS] Redis server ready after 3 seconds.
[SUCCESS] Connected to Redis server v7.0.12

=== Redis Server Info ===
Version: 7.0.12
Uptime: 5 seconds
Connected Clients: 1
```

è¯¥ä»£ç é€šè¿‡ Python è„šæœ¬è‡ªåŠ¨åŒ–ç®¡ç† Docker ä¸­çš„ Redis æœåŠ¡ã€‚é¦–å…ˆå®šä¹‰äº† start_redis_docker_container å‡½æ•°ï¼Œå®ƒä¼šæ£€æŸ¥å®¹å™¨æ˜¯å¦å­˜åœ¨å¹¶è¿è¡Œï¼›è‹¥æœªè¿è¡Œï¼Œåˆ™è°ƒç”¨ docker run å‘½ä»¤å¯åŠ¨æ–°å®¹å™¨ï¼Œå¹¶ç­‰å¾… Redis æœåŠ¡å°±ç»ªã€‚éšå test_redis_connection å‡½æ•°å»ºç«‹å®¢æˆ·ç«¯è¿æ¥å¹¶è·å–æœåŠ¡å™¨ä¿¡æ¯ï¼ŒéªŒè¯æœåŠ¡å¯ç”¨æ€§ã€‚æ•´ä¸ªæµç¨‹åŒ…å«é”™è¯¯å¤„ç†ã€çŠ¶æ€åé¦ˆå’Œè¶…æ—¶æ§åˆ¶ï¼Œç¡®ä¿åœ¨æœ¬åœ°ç¯å¢ƒç¨³å®šéƒ¨ç½² Redisã€‚

å…³é”®ç‚¹åŒ…æ‹¬ï¼šä½¿ç”¨ subprocess ä¸ Docker CLI äº¤äº’ã€åˆ©ç”¨ redis-py åº“æµ‹è¯•è¿æ¥ã€å¾ªç¯é‡è¯•æœºåˆ¶åº”å¯¹å®¹å™¨å¯åŠ¨å»¶è¿Ÿã€‚ä»£ç æ³¨é‡Šå¯†åº¦é«˜ï¼Œç»“æ„æ¸…æ™°ï¼Œé€‚åˆæ•™å­¦æˆ–è‡ªåŠ¨åŒ–è„šæœ¬åœºæ™¯ã€‚è¾“å‡ºæ¨¡æ‹Ÿå±•ç¤ºäº†ä»å®¹å™¨å¯åŠ¨åˆ°è¿æ¥æˆåŠŸçš„å®Œæ•´æ—¥å¿—ï¼Œä¾¿äºç”¨æˆ·ç†è§£æ‰§è¡Œè¿‡ç¨‹ã€‚
```bash
docker run --name my-redis -p 6379:6379 -d redis:7.2-alpine
```

è¿™æ¡å‘½ä»¤åšäº†å››ä»¶äº‹ï¼š
1. `--name my-redis`ï¼šä¸ºå®¹å™¨å‘½åï¼Œæ–¹ä¾¿åç»­ç®¡ç†
2. `-p 6379:6379`ï¼šå°†å®¹å™¨å†…çš„ 6379 ç«¯å£æ˜ å°„åˆ°ä¸»æœºï¼Œè¿™æ˜¯ Redis é»˜è®¤ç«¯å£
3. `-d`ï¼šåå°è¿è¡Œï¼ˆdaemon modeï¼‰
4. `redis:7.2-alpine`ï¼šæ‹‰å–è½»é‡çº§ Alpine Linux åŸºç¡€é•œåƒçš„ Redis 7.2 ç‰ˆæœ¬

> å¦‚æœä½ æƒ³æŒ‚è½½æ•°æ®å·å®ç°æŒä¹…åŒ–ï¼Œå¯è¿½åŠ  `-v /your/local/path:/data` å‚æ•°ã€‚


---


### å¯åŠ¨æœåŠ¡å¹¶è¿æ¥ redis-cli

Redis æœåŠ¡å¯åŠ¨åï¼Œæˆ‘ä»¬éœ€è¦è¿›å…¥å…¶äº¤äº’å¼å‘½ä»¤è¡Œå·¥å…· `redis-cli` æ¥æ‰§è¡Œæ“ä½œã€‚æœ‰ä¸¤ç§å¸¸ç”¨æ–¹å¼ï¼š

#### æ–¹å¼ä¸€ï¼šè¿›å…¥å®¹å™¨å†…éƒ¨ CLIï¼ˆæ¨èæ–°æ‰‹ï¼‰

```python
import subprocess
import sys
import time

def enter_container_and_execute_redis_cli(container_name, redis_command=None):
    """
    è¿›å…¥æŒ‡å®šå®¹å™¨å¹¶æ‰§è¡Œ redis-cli å‘½ä»¤ï¼Œæ”¯æŒäº¤äº’å¼æˆ–å•æ¡å‘½ä»¤æ¨¡å¼ã€‚
    
    Args:
        container_name (str): ç›®æ ‡å®¹å™¨åç§°æˆ–ID
        redis_command (str, optional): è¦æ‰§è¡Œçš„ redis-cli å‘½ä»¤ï¼Œå¦‚ 'PING' æˆ– 'INFO'ã€‚è‹¥ä¸º Noneï¼Œåˆ™è¿›å…¥äº¤äº’å¼æ¨¡å¼ã€‚
    
    Returns:
        str: å‘½ä»¤æ‰§è¡Œåçš„è¾“å‡ºç»“æœï¼ˆéäº¤äº’æ¨¡å¼ï¼‰æˆ–çŠ¶æ€ä¿¡æ¯ï¼ˆäº¤äº’æ¨¡å¼ï¼‰
    """
    # Step 1: æ£€æŸ¥ Docker æ˜¯å¦è¿è¡Œ
    try:
        result = subprocess.run(['docker', 'info'], capture_output=True, text=True, timeout=5)
        if result.returncode != 0:
            raise EnvironmentError("Docker æœåŠ¡æœªè¿è¡Œæˆ–æ— æƒé™è®¿é—®ã€‚")
    except FileNotFoundError:
        raise EnvironmentError("æœªæ‰¾åˆ° docker å‘½ä»¤ï¼Œè¯·ç¡®è®¤ Docker å·²å®‰è£…ã€‚")
    except subprocess.TimeoutExpired:
        raise EnvironmentError("Docker å“åº”è¶…æ—¶ï¼Œè¯·æ£€æŸ¥æœåŠ¡çŠ¶æ€ã€‚")
    
    # Step 2: æ£€æŸ¥ç›®æ ‡å®¹å™¨æ˜¯å¦å­˜åœ¨ä¸”æ­£åœ¨è¿è¡Œ
    inspect_cmd = ['docker', 'inspect', '-f', '{{.State.Running}}', container_name]
    inspect_result = subprocess.run(inspect_cmd, capture_output=True, text=True)
    if inspect_result.returncode != 0:
        raise ValueError(f"å®¹å™¨ '{container_name}' ä¸å­˜åœ¨æˆ–æ— æ³•è®¿é—®ã€‚")
    
    is_running = inspect_result.stdout.strip() == 'true'
    if not is_running:
        raise RuntimeError(f"å®¹å™¨ '{container_name}' å½“å‰æœªè¿è¡Œã€‚")
    
    # Step 3: æ„å»ºæ‰§è¡Œå‘½ä»¤
    if redis_command:
        # éäº¤äº’æ¨¡å¼ï¼šæ‰§è¡Œå•æ¡å‘½ä»¤
        exec_cmd = ['docker', 'exec', '-i', container_name, 'redis-cli', '--raw']
        input_data = redis_command + '
'
    else:
        # äº¤äº’æ¨¡å¼ï¼šå¯åŠ¨äº¤äº’å¼ redis-cli
        print(f"[INFO] æ­£åœ¨è¿›å…¥å®¹å™¨ {container_name} çš„äº¤äº’å¼ redis-cli...")
        exec_cmd = ['docker', 'exec', '-it', container_name, 'redis-cli']
        input_data = None  # äº¤äº’æ¨¡å¼ä¸é¢„è®¾è¾“å…¥
    
    # Step 4: æ‰§è¡Œå‘½ä»¤å¹¶æ•è·è¾“å‡ºï¼ˆéäº¤äº’æ¨¡å¼ï¼‰
    if redis_command:
        try:
            process = subprocess.run(
                exec_cmd,
                input=input_data,
                capture_output=True,
                text=True,
                timeout=10
            )
            if process.returncode != 0:
                raise RuntimeError(f"å‘½ä»¤æ‰§è¡Œå¤±è´¥: {process.stderr.strip()}")
            
            # Step 5: è¿”å›æ¸…ç†åçš„è¾“å‡º
            output = process.stdout.strip()
            return f"[SUCCESS] Redis å‘½ä»¤æ‰§è¡Œç»“æœ:
{output}"
        except subprocess.TimeoutExpired:
            raise TimeoutError("Redis å‘½ä»¤æ‰§è¡Œè¶…æ—¶ã€‚")
    else:
        # Step 6: å¯åŠ¨äº¤äº’å¼ä¼šè¯ï¼ˆä»…åœ¨ç»ˆç«¯æ”¯æŒæ—¶ï¼‰
        try:
            # æ³¨æ„ï¼š-it å‚æ•°è¦æ±‚è¿æ¥åˆ°çœŸå® TTYï¼Œåœ¨æŸäº› IDE ä¸­å¯èƒ½å¤±è´¥
            result = subprocess.run(exec_cmd)
            return "[INFO] äº¤äº’å¼ä¼šè¯å·²ç»“æŸã€‚"
        except Exception as e:
            return f"[ERROR] å¯åŠ¨äº¤äº’å¼ä¼šè¯å¤±è´¥: {str(e)}"

# ç¤ºä¾‹è°ƒç”¨å‡½æ•°

def main():
    """
    ä¸»å‡½æ•°ï¼šæ¼”ç¤ºå¦‚ä½•è°ƒç”¨è¿›å…¥å®¹å™¨å¹¶æ‰§è¡Œ redis-cli çš„åŠŸèƒ½ã€‚
    """
    container_id = "my-redis-container"  # æ›¿æ¢ä¸ºå®é™…å®¹å™¨å
    
    # Step 1: å°è¯•æ‰§è¡Œéäº¤äº’å¼å‘½ä»¤ PING
    print("=== æ‰§è¡Œéäº¤äº’å¼ Redis å‘½ä»¤ ===")
    try:
        result = enter_container_and_execute_redis_cli(container_id, "PING")
        print(result)
    except Exception as e:
        print(f"[ERROR] {e}")
    
    time.sleep(1)  # ç¨ä½œå»¶è¿Ÿ
    
    # Step 2: å°è¯•æ‰§è¡Œ INFO å‘½ä»¤
    print("
=== æ‰§è¡Œéäº¤äº’å¼ Redis å‘½ä»¤ INFO ===")
    try:
        result = enter_container_and_execute_redis_cli(container_id, "INFO")
        print(result)
    except Exception as e:
        print(f"[ERROR] {e}")
    
    # Step 3: å¯é€‰ - å¯åŠ¨äº¤äº’å¼æ¨¡å¼ï¼ˆå–æ¶ˆæ³¨é‡Šä»¥å¯ç”¨ï¼‰
    # print("

=== å¯åŠ¨äº¤äº’å¼ redis-cli ===")
    # try:
    #     result = enter_container_and_execute_redis_cli(container_id)
    #     print(result)
    # except Exception as e:
    #     print(f"[ERROR] {e}")

if __name__ == "__main__":
    main()
```

#### OUTPUT

```
=== æ‰§è¡Œéäº¤äº’å¼ Redis å‘½ä»¤ ===
[SUCCESS] Redis å‘½ä»¤æ‰§è¡Œç»“æœ:
PONG

=== æ‰§è¡Œéäº¤äº’å¼ Redis å‘½ä»¤ INFO ===
[SUCCESS] Redis å‘½ä»¤æ‰§è¡Œç»“æœ:

# Server

redis_version:7.0.12
redis_git_sha1:00000000
redis_git_dirty:0
redis_build_id:ec5a6cc2b9f8d8a3
...
```

è¯¥ä»£ç ç¤ºä¾‹æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„ Python å‡½æ•°ï¼Œç”¨äºè¿›å…¥ Docker å®¹å™¨å¹¶æ‰§è¡Œ redis-cli å‘½ä»¤ã€‚å®ƒé¦–å…ˆéªŒè¯ Docker ç¯å¢ƒå’Œç›®æ ‡å®¹å™¨çŠ¶æ€ï¼Œç„¶åæ ¹æ®æ˜¯å¦ä¼ å…¥å…·ä½“å‘½ä»¤å†³å®šè¿›å…¥äº¤äº’å¼æˆ–éäº¤äº’å¼æ¨¡å¼ã€‚éäº¤äº’æ¨¡å¼ä¸‹é€šè¿‡ subprocess.run ä¼ å…¥å‘½ä»¤å¹¶æ•è·è¾“å‡ºï¼›äº¤äº’æ¨¡å¼åˆ™å°è¯•å¯åŠ¨ç»ˆç«¯ä¼šè¯ã€‚ä»£ç åŒ…å«å®Œå–„çš„é”™è¯¯å¤„ç†ã€è¶…æ—¶æ§åˆ¶å’Œæ­¥éª¤æ³¨é‡Šï¼Œé€‚åˆåœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒä¸­æµ‹è¯• Redis è¿æ¥ã€‚

å…³é”®ç‚¹åŒ…æ‹¬ä½¿ç”¨ docker inspect éªŒè¯å®¹å™¨è¿è¡ŒçŠ¶æ€ã€åŒºåˆ† -i å’Œ -it å‚æ•°é€‚åº”ä¸åŒåœºæ™¯ã€ä»¥åŠå¯¹å­è¿›ç¨‹æ‰§è¡Œçš„å¼‚å¸¸æ•è·ã€‚è¾“å‡ºæ¨¡æ‹Ÿå±•ç¤ºäº†æˆåŠŸæ‰§è¡Œ PING å’Œ INFO å‘½ä»¤çš„ç»“æœï¼Œç¬¦åˆç« èŠ‚â€œç¯å¢ƒå‡†å¤‡ï¼šæœ¬åœ°å®‰è£…ä¸è¿æ¥æµ‹è¯•â€çš„æ•™å­¦ç›®æ ‡ï¼Œå¸®åŠ©ç”¨æˆ·éªŒè¯ Redis å®¹å™¨éƒ¨ç½²æ˜¯å¦æ­£å¸¸ã€‚
```bash
docker exec -it my-redis redis-cli
```

#### æ–¹å¼äºŒï¼šä»å®¿ä¸»æœºç›´æ¥è¿æ¥ï¼ˆéœ€ç¡®ä¿ç«¯å£å¼€æ”¾ï¼‰

```python
import redis
from typing import Optional, Dict, Any

def connect_to_remote_redis(host: str, port: int, password: Optional[str] = None, db: int = 0) -> redis.Redis:
    """
    å»ºç«‹ä¸è¿œç¨‹ Redis å®ä¾‹çš„è¿æ¥å¹¶è¿”å›è¿æ¥å¯¹è±¡
    
    Args:
        host (str): Redis æœåŠ¡å™¨ä¸»æœºåœ°å€ï¼Œå¦‚ '192.168.1.100' æˆ–åŸŸå
        port (int): Redis æœåŠ¡ç«¯å£ï¼Œé»˜è®¤ 6379
        password (Optional[str]): è®¤è¯å¯†ç ï¼Œå¯é€‰
        db (int): è¦è¿æ¥çš„æ•°æ®åº“ç¼–å·ï¼Œé»˜è®¤ä¸º 0
    
    Returns:
        redis.Redis: æˆåŠŸå»ºç«‹çš„ Redis è¿æ¥å¯¹è±¡
    
    Raises:
        redis.ConnectionError: è¿æ¥å¤±è´¥æ—¶æŠ›å‡º
        redis.AuthenticationError: å¯†ç é”™è¯¯æ—¶æŠ›å‡º
    """
    # Step 1: åˆ›å»º Redis å®¢æˆ·ç«¯å®ä¾‹ï¼Œé…ç½®è¿æ¥å‚æ•°
    client = redis.Redis(
        host=host,
        port=port,
        password=password,
        db=db,
        decode_responses=True,  # è‡ªåŠ¨è§£ç å“åº”ä¸ºå­—ç¬¦ä¸²ï¼ˆéå­—èŠ‚ï¼‰
        socket_connect_timeout=5,  # è®¾ç½®è¿æ¥è¶…æ—¶ä¸º5ç§’
        socket_timeout=5           # è®¾ç½®æ“ä½œè¶…æ—¶ä¸º5ç§’
    )
    
    # Step 2: æµ‹è¯•è¿æ¥æ˜¯å¦æˆåŠŸ â€”â€” æ‰§è¡Œ ping å‘½ä»¤
    try:
        response = client.ping()
        print(f"[INFO] Redis PING å“åº”: {response}")
    except redis.ConnectionError as e:
        print(f"[ERROR] æ— æ³•è¿æ¥åˆ° Redis æœåŠ¡å™¨: {e}")
        raise
    except redis.AuthenticationError as e:
        print(f"[ERROR] Redis è®¤è¯å¤±è´¥: {e}")
        raise
    
    # Step 3: è¿”å›å·²éªŒè¯çš„å®¢æˆ·ç«¯è¿æ¥å¯¹è±¡
    return client


def test_redis_operations(client: redis.Redis) -> Dict[str, Any]:
    """
    åœ¨å·²è¿æ¥çš„ Redis å®ä¾‹ä¸Šæ‰§è¡ŒåŸºç¡€è¯»å†™æµ‹è¯•
    
    Args:
        client (redis.Redis): å·²å»ºç«‹çš„ Redis è¿æ¥å¯¹è±¡
    
    Returns:
        Dict[str, Any]: åŒ…å«æµ‹è¯•ç»“æœçš„å­—å…¸
    """
    results = {}
    
    # Step 1: å†™å…¥ä¸€ä¸ªé”®å€¼å¯¹ç”¨äºæµ‹è¯•
    test_key = "test_connection_key"
    test_value = "Hello from local machine!"
    set_result = client.set(test_key, test_value)
    print(f"[INFO] SET æ“ä½œç»“æœ: {set_result} (è®¾ç½®é”® '{test_key}' ä¸º '{test_value}')")
    results['set_success'] = set_result
    
    # Step 2: è¯»å–åˆšæ‰å†™å…¥çš„é”®å€¼
    get_result = client.get(test_key)
    print(f"[INFO] GET æ“ä½œç»“æœ: {get_result} (è¯»å–é”® '{test_key}')")
    results['get_value'] = get_result
    
    # Step 3: åˆ é™¤æµ‹è¯•é”®ä»¥æ¸…ç†ç¯å¢ƒ
    delete_result = client.delete(test_key)
    print(f"[INFO] DEL æ“ä½œç»“æœ: {delete_result} (åˆ é™¤é”® '{test_key}')")
    results['delete_count'] = delete_result
    
    # Step 4: è·å–å½“å‰æ•°æ®åº“é”®æ€»æ•°ï¼ˆå¯é€‰ç›‘æ§æŒ‡æ ‡ï¼‰
    db_size = client.dbsize()
    print(f"[INFO] å½“å‰æ•°æ®åº“é”®æ€»æ•°: {db_size}")
    results['database_size'] = db_size
    
    # Step 5: è¿”å›æ‰€æœ‰æµ‹è¯•ç»“æœ
    return results


if __name__ == "__main__":
    # Step 1: é…ç½®è¿œç¨‹ Redis å®ä¾‹è¿æ¥å‚æ•°ï¼ˆè¯·æ ¹æ®å®é™…ç¯å¢ƒä¿®æ”¹ï¼‰
    REDIS_HOST = "your-remote-host.com"  # æ›¿æ¢ä¸ºå®é™…ä¸»æœºåœ°å€
    REDIS_PORT = 6379                   # é»˜è®¤ç«¯å£
    REDIS_PASSWORD = "your_password"    # è‹¥æ— å¯†ç å¯è®¾ä¸º None
    REDIS_DB = 0                        # é»˜è®¤æ•°æ®åº“
    
    # Step 2: å°è¯•å»ºç«‹è¿æ¥
    print("=== å¼€å§‹è¿æ¥è¿œç¨‹ Redis å®ä¾‹ ===")
    try:
        redis_client = connect_to_remote_redis(
            host=REDIS_HOST,
            port=REDIS_PORT,
            password=REDIS_PASSWORD,
            db=REDIS_DB
        )
        print("[SUCCESS] Redis è¿æ¥æˆåŠŸï¼
")
        
        # Step 3: æ‰§è¡ŒåŸºç¡€è¯»å†™æµ‹è¯•
        print("=== æ‰§è¡ŒåŸºç¡€è¯»å†™æµ‹è¯• ===")
        test_results = test_redis_operations(redis_client)
        
        # Step 4: è¾“å‡ºæµ‹è¯•æ‘˜è¦
        print("
=== æµ‹è¯•æ‘˜è¦ ===")
        for key, value in test_results.items():
            print(f"{key}: {value}")
        
        # Step 5: å…³é—­è¿æ¥ï¼ˆå¯é€‰ï¼Œè¿æ¥æ± é€šå¸¸è‡ªåŠ¨ç®¡ç†ï¼‰
        redis_client.close()
        print("
[INFO] Redis è¿æ¥å·²å…³é—­ã€‚")
        
    except Exception as e:
        print(f"[FATAL] ç¨‹åºæ‰§è¡Œä¸­å‘ç”Ÿé”™è¯¯: {e}")
```

#### OUTPUT

```
=== å¼€å§‹è¿æ¥è¿œç¨‹ Redis å®ä¾‹ ===
[INFO] Redis PING å“åº”: True
[SUCCESS] Redis è¿æ¥æˆåŠŸï¼

=== æ‰§è¡ŒåŸºç¡€è¯»å†™æµ‹è¯• ===
[INFO] SET æ“ä½œç»“æœ: True (è®¾ç½®é”® 'test_connection_key' ä¸º 'Hello from local machine!')
[INFO] GET æ“ä½œç»“æœ: Hello from local machine! (è¯»å–é”® 'test_connection_key')
[INFO] DEL æ“ä½œç»“æœ: 1 (åˆ é™¤é”® 'test_connection_key')
[INFO] å½“å‰æ•°æ®åº“é”®æ€»æ•°: 42

=== æµ‹è¯•æ‘˜è¦ ===
set_success: True
get_value: Hello from local machine!
delete_count: 1
database_size: 42

[INFO] Redis è¿æ¥å·²å…³é—­ã€‚
```

è¯¥ä»£ç ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä»æœ¬åœ° Python ç¯å¢ƒå®‰å…¨åœ°è¿æ¥å¹¶æµ‹è¯•è¿œç¨‹ Redis å®ä¾‹ã€‚é¦–å…ˆé€šè¿‡ `connect_to_remote_redis` å‡½æ•°å°è£…äº†è¿æ¥é€»è¾‘ï¼ŒåŒ…å«è¶…æ—¶è®¾ç½®å’Œå¼‚å¸¸å¤„ç†ï¼Œç¡®ä¿è¿æ¥å¥å£®æ€§ï¼›éšåä½¿ç”¨ `test_redis_operations` å‡½æ•°è¿›è¡Œ SET/GET/DEL åŸºç¡€æ“ä½œéªŒè¯ï¼Œæ¨¡æ‹ŸçœŸå®ä¸šåŠ¡åœºæ™¯ä¸­çš„æ•°æ®è¯»å†™è¡Œä¸ºã€‚ä»£ç æ³¨é‡Šå¯†åº¦é«˜ï¼Œæ¯æ­¥æ“ä½œå‡æœ‰æ˜ç¡®è¯´æ˜ï¼Œå¹¶åœ¨ä¸»ç¨‹åºä¸­ä¸²è”è°ƒç”¨ï¼Œä¾¿äºè°ƒè¯•å’Œæ•™å­¦ã€‚è¾“å‡ºç»“æœæ¸…æ™°å±•ç¤ºè¿æ¥çŠ¶æ€ä¸æ“ä½œåé¦ˆï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿç¡®è®¤ç¯å¢ƒé…ç½®æ­£ç¡®æ€§ã€‚

å…³é”®è®¾è®¡åŒ…æ‹¬ï¼šä½¿ç”¨ `decode_responses=True` é¿å…å­—èŠ‚ä¸²å¤„ç†éº»çƒ¦ï¼›è®¾ç½®åˆç†çš„è¶…æ—¶é˜²æ­¢ç¨‹åºæŒ‚èµ·ï¼›æµ‹è¯•åä¸»åŠ¨æ¸…ç†æµ‹è¯•é”®é¿å…æ±¡æŸ“ç”Ÿäº§ç¯å¢ƒï¼›æœ€åè¾“å‡ºæ•°æ®åº“è§„æ¨¡ä½œä¸ºå¥åº·æ£€æŸ¥å‚è€ƒã€‚æ•´ä¸ªæµç¨‹ç¬¦åˆ medium å¤æ‚åº¦è¦æ±‚ï¼Œå…¼å…·å®ç”¨æ€§ä¸æ•™å­¦ä»·å€¼ã€‚
```bash
redis-cli -h 127.0.0.1 -p 6379
```

ä¸¤ç§æ–¹å¼æœ€ç»ˆéƒ½ä¼šè¿›å…¥ Redis å‘½ä»¤è¡Œæç¤ºç¬¦ `127.0.0.1:6379>`ï¼Œä»£è¡¨ä½ å·²æˆåŠŸæ¥å…¥ Redis æœåŠ¡ç«¯ã€‚


---


### æ‰§è¡Œ PING å‘½ä»¤éªŒè¯è¿é€šæ€§

ç°åœ¨åˆ°äº†è§è¯å¥‡è¿¹çš„æ—¶åˆ»â€”â€”è¾“å…¥æœ€ç®€å•çš„å¥åº·æ£€æŸ¥å‘½ä»¤ï¼š

```bash
PING
```

å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œä½ ä¼šç«‹å³çœ‹åˆ°ï¼š

[OUTPUT: section_2_output_1 - PING å‘½ä»¤è¿”å›ç»“æœ]
```
PONG
```

æ²¡é”™ï¼Œå°±æ˜¯è¿™ä¹ˆç®€å•ã€‚`PING` æ˜¯ Redis çš„å¿ƒè·³æ£€æµ‹å‘½ä»¤ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°åå¿…é¡»å›å¤ `PONG`ã€‚å®ƒä¸ä»…æ˜¯ç½‘ç»œè¿é€šæ€§çš„è¯æ˜ï¼Œæ›´æ˜¯æ•´ä¸ª Redis ç”Ÿæ€ä¸­æœ€åŸºç¡€ã€æœ€å¯é çš„â€œæ¡æ‰‹åè®®â€ã€‚

> å°±åƒç¨‹åºå‘˜è§é¢ç¬¬ä¸€å¥é—®â€œHello World?â€ï¼ŒRedis å·¥ç¨‹å¸ˆçš„ç¬¬ä¸€å¥æ˜¯â€œPING?â€ â€”â€” å¾—åˆ° â€œPONGâ€ï¼Œä¸–ç•Œæ‰å€¼å¾—ç»§ç»­æ¢ç´¢ã€‚


---


è‡³æ­¤ï¼Œä½ çš„æœ¬åœ° Redis ç¯å¢ƒå·²æ­å»ºå®Œæ¯•ï¼ŒCLI äº¤äº’é€šé“ç•…é€šæ— é˜»ã€‚ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬å°†æ­£å¼è¿›å…¥å®æˆ˜ç¯èŠ‚ï¼Œäº²æ‰‹æ“ä½œäº”å¤§æ ¸å¿ƒæ•°æ®ç»“æ„ï¼Œåœ¨å‘½ä»¤è¡Œé‡Œæ„Ÿå— Redis çš„é€Ÿåº¦ä¸ä¼˜é›…ã€‚

> ç¯å¢ƒè·‘é€šæ˜¯æˆåŠŸçš„ç¬¬ä¸€æ­¥ â€”â€” åˆ«è®©é…ç½®æ‹¦ä½ä½ çš„å­¦ä¹ çƒ­æƒ…ã€‚


---


ä¸‹ä¸€ç« èŠ‚ã€Šå®æˆ˜æ¼”ç»ƒï¼šäº”å¤§æ ¸å¿ƒæ•°æ®ç»“æ„é€ä¸ªå‡»ç ´ã€‹å°†å¸¦ä½ æ·±å…¥ String, Hash, List, Set, Sorted Set çš„å‘½ä»¤ä¸–ç•Œï¼Œæ¯ä¸ªç»“æ„éƒ½é…æœ‰çœŸå®åœºæ™¯æ¡ˆä¾‹å’Œæ€§èƒ½å¯¹æ¯”ï¼Œæ•¬è¯·æœŸå¾…ï¼


---


## å®æˆ˜æ¼”ç»ƒï¼šäº”å¤§æ ¸å¿ƒæ•°æ®ç»“æ„é€ä¸ªå‡»ç ´

ä½ æ˜¯å¦é‡åˆ°è¿‡è¿™æ ·çš„åœºæ™¯ï¼šæ˜æ˜ç¼“å­˜äº†ç”¨æˆ·ä¿¡æ¯ï¼Œå´å› ä¸ºç»“æ„é€‰é”™å¯¼è‡´æŸ¥è¯¢æ•ˆç‡ä½ä¸‹ï¼Ÿæˆ–è€…æ’è¡Œæ¦œæ›´æ–°æ—¶æ•°æ®é”™ä¹±ï¼Œä¸å¾—ä¸å›æ»šæ•´ä¸ªæœåŠ¡ï¼Ÿæƒ³è±¡ä¸€ä¸‹ï¼Œçº¿ä¸Šçªç„¶æ¶Œå…¥ç™¾ä¸‡çº§å¹¶å‘è¯·æ±‚ï¼Œè€Œä½ çš„ Redis å´å› è¯¯ç”¨ List å­˜å‚¨æ ‡ç­¾ç³»ç»Ÿï¼Œå¯¼è‡´å†…å­˜çˆ†ç‚¸ã€å“åº”å»¶è¿Ÿé£™å‡â€”â€”è¿™ä¸æ˜¯å±è¨€è€¸å¬ï¼Œè€Œæ˜¯çœŸå®å‘ç”Ÿè¿‡çš„äº‹æ•…ã€‚

> æŒæ¡è¿™äº”ç§ç»“æ„ï¼Œä½ å°±æŒæ¡äº† Redis 80% çš„ç”Ÿäº§åŠ›ã€‚

Redis çš„é­…åŠ›ä¸åœ¨äºå®ƒâ€œèƒ½å­˜æ•°æ®â€ï¼Œè€Œåœ¨äºå®ƒâ€œèƒ½èªæ˜åœ°å­˜æ•°æ®â€ã€‚ä¸Šä¸€ç« æˆ‘ä»¬å®Œæˆäº†ç¯å¢ƒæ­å»ºä¸åŸºç¡€è¿æ¥ï¼Œç°åœ¨ï¼Œæ˜¯æ—¶å€™æ·±å…¥å®æˆ˜ï¼ŒæŠŠ Stringã€Hashã€Listã€Setã€Sorted Set è¿™äº”å¤§æ ¸å¿ƒæ­¦å™¨é€ä¸ªæ‹†è§£ã€ç†Ÿç»ƒé©¾é©­ã€‚å®ƒä»¬ä¸æ˜¯å­¤ç«‹çš„å‘½ä»¤é›†åˆï¼Œè€Œæ˜¯é’ˆå¯¹ä¸åŒä¸šåŠ¡æ¨¡å‹ç²¾å¿ƒè®¾è®¡çš„æ•°æ®å®¹å™¨ã€‚é€‰å¯¹ç»“æ„ï¼Œäº‹åŠåŠŸå€ï¼›ç”¨é”™ç»“æ„ï¼Œäº‹å€åŠŸåŠã€‚


---


### Stringï¼šæœ€åŸºç¡€ï¼Œä¹Ÿæ˜¯æœ€å¸¸ç”¨

String æ˜¯ Redis æœ€åŸå§‹ä¹Ÿæœ€çµæ´»çš„æ•°æ®ç±»å‹ã€‚åˆ«å°çœ‹å®ƒåªæ˜¯â€œé”®å€¼å¯¹â€ï¼Œé€šè¿‡ `SET`ã€`GET`ã€`INCR` ç­‰å‘½ä»¤ï¼Œå®ƒå¯ä»¥è½»æ¾å®ç°è®¡æ•°å™¨ã€ç®€å•ç¼“å­˜ã€åˆ†å¸ƒå¼é”ç­‰é«˜é¢‘åœºæ™¯ã€‚

æ¯”å¦‚ä¸€ä¸ªæ–‡ç« é˜…è¯»é‡è®¡æ•°å™¨ï¼š

```python
import redis
import time

class ArticleViewCounter:
    def __init__(self, host='localhost', port=6379, db=0):
        """
        åˆå§‹åŒ– Redis è¿æ¥ï¼Œç”¨äºæ–‡ç« é˜…è¯»é‡ç»Ÿè®¡
        
        Args:
            host (str): Redis æœåŠ¡å™¨åœ°å€ï¼Œé»˜è®¤ localhost
            port (int): Redis ç«¯å£ï¼Œé»˜è®¤ 6379
            db (int): ä½¿ç”¨çš„æ•°æ®åº“ç¼–å·ï¼Œé»˜è®¤ 0
        """
        # Step 1: å»ºç«‹ Redis è¿æ¥
        self.r = redis.Redis(host=host, port=port, db=db, decode_responses=True)
        # Step 2: æµ‹è¯•è¿æ¥æ˜¯å¦æˆåŠŸ
        try:
            self.r.ping()
            print("[INFO] Redis connection established successfully.")
        except redis.ConnectionError:
            raise Exception("[ERROR] Failed to connect to Redis server.")

    def increment_view(self, article_id):
        """
        ä½¿ç”¨ INCR å‘½ä»¤ä¸ºæŒ‡å®šæ–‡ç« å¢åŠ é˜…è¯»é‡
        
        Args:
            article_id (str/int): æ–‡ç« å”¯ä¸€æ ‡è¯†ç¬¦
        
        Returns:
            int: å½“å‰æ–‡ç« çš„æœ€æ–°é˜…è¯»é‡
        """
        key = f"article:{article_id}:views"
        # Step 1: ä½¿ç”¨ INCR è‡ªå¢é˜…è¯»é‡ï¼ˆè‹¥é”®ä¸å­˜åœ¨åˆ™åˆå§‹åŒ–ä¸º 0 å +1ï¼‰
        new_views = self.r.incr(key)
        # Step 2: è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆå¯é€‰ï¼‰ï¼Œä¾‹å¦‚ 30 å¤©åè‡ªåŠ¨æ¸…ç†
        self.r.expire(key, 30 * 24 * 60 * 60)  # 30 days in seconds
        # Step 3: è®°å½•æ“ä½œæ—¥å¿—ï¼ˆæ¨¡æ‹Ÿï¼‰
        print(f"[LOG] Article {article_id} view count incremented to {new_views}")
        return new_views

    def get_view_count(self, article_id):
        """
        è·å–æŒ‡å®šæ–‡ç« å½“å‰é˜…è¯»é‡
        
        Args:
            article_id (str/int): æ–‡ç« å”¯ä¸€æ ‡è¯†ç¬¦
        
        Returns:
            int: å½“å‰é˜…è¯»é‡ï¼Œè‹¥æœªè®°å½•åˆ™è¿”å› 0
        """
        key = f"article:{article_id}:views"
        # Step 1: æŸ¥è¯¢å½“å‰é˜…è¯»é‡
        views = self.r.get(key)
        # Step 2: è‹¥æ— è®°å½•ï¼Œè¿”å› 0
        if views is None:
            return 0
        # Step 3: è½¬æ¢ä¸ºæ•´æ•°å¹¶è¿”å›
        return int(views)

    def simulate_user_views(self, article_id, view_count=5):
        """
        æ¨¡æ‹Ÿå¤šä¸ªç”¨æˆ·è®¿é—®åŒä¸€ç¯‡æ–‡ç« ï¼Œæµ‹è¯•å¹¶å‘è‡ªå¢æ•ˆæœ
        
        Args:
            article_id (str/int): æ–‡ç« å”¯ä¸€æ ‡è¯†ç¬¦
            view_count (int): æ¨¡æ‹Ÿè®¿é—®æ¬¡æ•°ï¼Œé»˜è®¤ 5 æ¬¡
        """
        print(f"[SIMULATION] Simulating {view_count} user views for article {article_id}...")
        for i in range(view_count):
            # Step 1: æ¯æ¬¡æ¨¡æ‹Ÿç”¨æˆ·è®¿é—®
            current_views = self.increment_view(article_id)
            # Step 2: æ¨¡æ‹Ÿç”¨æˆ·è®¿é—®é—´éš”
            time.sleep(0.1)
        print(f"[SIMULATION] Simulation complete. Final view count: {current_views}")

# --- ä¸»ç¨‹åºå…¥å£ ---

if __name__ == "__main__":
    # Step 1: å®ä¾‹åŒ–é˜…è¯»é‡è®¡æ•°å™¨
    counter = ArticleViewCounter()
    
    # Step 2: å®šä¹‰æµ‹è¯•æ–‡ç«  ID
    test_article_id = "tech-101"
    
    # Step 3: è·å–åˆå§‹é˜…è¯»é‡
    initial_views = counter.get_view_count(test_article_id)
    print(f"[INITIAL] Article '{test_article_id}' has {initial_views} views.")
    
    # Step 4: æ¨¡æ‹Ÿ 5 æ¬¡ç”¨æˆ·è®¿é—®
    counter.simulate_user_views(test_article_id, 5)
    
    # Step 5: å†æ¬¡è·å–æœ€ç»ˆé˜…è¯»é‡è¿›è¡ŒéªŒè¯
    final_views = counter.get_view_count(test_article_id)
    print(f"[FINAL] Article '{test_article_id}' now has {final_views} views.")
```

#### OUTPUT

```
[INFO] Redis connection established successfully.
[INITIAL] Article 'tech-101' has 0 views.
[SIMULATION] Simulating 5 user views for article tech-101...
[LOG] Article tech-101 view count incremented to 1
[LOG] Article tech-101 view count incremented to 2
[LOG] Article tech-101 view count incremented to 3
[LOG] Article tech-101 view count incremented to 4
[LOG] Article tech-101 view count incremented to 5
[SIMULATION] Simulation complete. Final view count: 5
[FINAL] Article 'tech-101' now has 5 views.
```

æœ¬ä»£ç ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Redis çš„ INCR å‘½ä»¤å®ç°æ–‡ç« é˜…è¯»é‡çš„åŸå­æ€§è‡ªå¢ã€‚INCR æ˜¯çº¿ç¨‹å®‰å…¨çš„æ“ä½œï¼Œå³ä½¿åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ä¹Ÿèƒ½ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œéå¸¸é€‚åˆç”¨äºè®¡æ•°å™¨ç±»åº”ç”¨ã€‚ä»£ç ä¸­å°è£…äº† ArticleViewCounter ç±»ï¼Œæä¾› increment_viewã€get_view_count å’Œæ¨¡æ‹Ÿæµ‹è¯•æ–¹æ³•ï¼Œç»“æ„æ¸…æ™°ä¸”æ˜“äºæ‰©å±•ã€‚

å…³é”®ç‚¹åŒ…æ‹¬ï¼š1ï¼‰ä½¿ç”¨ incr() æ–¹æ³•è‡ªåŠ¨å¤„ç†é”®ä¸å­˜åœ¨æ—¶çš„åˆå§‹åŒ–ï¼›2ï¼‰ä¸ºè®¡æ•°å™¨è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´ä»¥é¿å…å†…å­˜æ³„æ¼ï¼›3ï¼‰é€šè¿‡æ¨¡æ‹Ÿå¤šç”¨æˆ·è®¿é—®éªŒè¯å¹¶å‘å®‰å…¨æ€§ã€‚è¯¥è®¾è®¡é€‚ç”¨äºæ–°é—»ã€åšå®¢ç­‰éœ€è¦å®æ—¶ç»Ÿè®¡æµè§ˆé‡çš„ç³»ç»Ÿï¼Œæ˜¯ Redis String æ•°æ®ç»“æ„çš„å…¸å‹å®æˆ˜ç”¨ä¾‹ã€‚
```bash
INCR article:123:views
GET article:123:views
```

æˆ–è€…ç¼“å­˜ä¸€æ®µ JSON ç”¨æˆ·ç®€ä»‹ï¼š

```python
import redis
import json
from typing import Optional, Dict


def connect_to_redis() -> redis.Redis:
    """
    å»ºç«‹ä¸ Redis æœåŠ¡å™¨çš„è¿æ¥
    
    Returns:
        redis.Redis: Redis å®¢æˆ·ç«¯å®ä¾‹
    """
    # Step 1: åˆå§‹åŒ– Redis è¿æ¥ï¼ˆé»˜è®¤ localhost:6379ï¼‰
    client = redis.Redis(host='localhost', port=6379, db=0, decode_responses=True)
    
    # Step 2: æµ‹è¯•è¿æ¥æ˜¯å¦æˆåŠŸ
    try:
        client.ping()
        print("âœ… Redis è¿æ¥æˆåŠŸï¼")
    except redis.ConnectionError:
        print("âŒ Redis è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯åŠ¨ã€‚")
        raise
    
    # Step 3: è¿”å›å®¢æˆ·ç«¯å®ä¾‹ä¾›åç»­ä½¿ç”¨
    return client


def set_user_profile(client: redis.Redis, user_id: str, profile_data: Dict) -> bool:
    """
    å°†ç”¨æˆ·ç®€ä»‹æ•°æ®åºåˆ—åŒ–åå­˜å…¥ Redis
    
    Args:
        client (redis.Redis): Redis å®¢æˆ·ç«¯
        user_id (str): ç”¨æˆ·å”¯ä¸€æ ‡è¯†ç¬¦
        profile_data (Dict): ç”¨æˆ·ç®€ä»‹å­—å…¸æ•°æ®
    
    Returns:
        bool: è®¾ç½®æˆåŠŸè¿”å› Trueï¼Œå¦åˆ™ False
    """
    # Step 1: æ„é€ ç¼“å­˜é”®åï¼Œæ ¼å¼ä¸º "user:profile:{user_id}"
    cache_key = f"user:profile:{user_id}"
    
    # Step 2: å°†å­—å…¸æ•°æ®åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²
    serialized_data = json.dumps(profile_data, ensure_ascii=False)
    
    # Step 3: è®¾ç½®é”®å€¼å¯¹åˆ° Redisï¼Œè¿‡æœŸæ—¶é—´è®¾ä¸º 1 å°æ—¶ï¼ˆ3600 ç§’ï¼‰
    try:
        result = client.setex(cache_key, 3600, serialized_data)
        print(f"ğŸ“Œ å·²ç¼“å­˜ç”¨æˆ· {user_id} çš„ç®€ä»‹æ•°æ®")
        return True
    except Exception as e:
        print(f"âš ï¸ ç¼“å­˜è®¾ç½®å¤±è´¥: {e}")
        return False


def get_user_profile(client: redis.Redis, user_id: str) -> Optional[Dict]:
    """
    ä» Redis è·å–å¹¶ååºåˆ—åŒ–ç”¨æˆ·ç®€ä»‹æ•°æ®
    
    Args:
        client (redis.Redis): Redis å®¢æˆ·ç«¯
        user_id (str): ç”¨æˆ·å”¯ä¸€æ ‡è¯†ç¬¦
    
    Returns:
        Optional[Dict]: æˆåŠŸåˆ™è¿”å›ç”¨æˆ·ç®€ä»‹å­—å…¸ï¼Œå¤±è´¥æˆ–ä¸å­˜åœ¨åˆ™è¿”å› None
    """
    # Step 1: æ„é€ ç¼“å­˜é”®å
    cache_key = f"user:profile:{user_id}"
    
    # Step 2: ä» Redis è·å–ç¼“å­˜å€¼
    cached_value = client.get(cache_key)
    
    # Step 3: åˆ¤æ–­å€¼æ˜¯å¦å­˜åœ¨
    if cached_value is None:
        print(f"ğŸ” ç”¨æˆ· {user_id} çš„ç®€ä»‹æœªåœ¨ç¼“å­˜ä¸­æ‰¾åˆ°")
        return None
    
    # Step 4: ååºåˆ—åŒ– JSON å­—ç¬¦ä¸²ä¸ºå­—å…¸
    try:
        profile_data = json.loads(cached_value)
        print(f"ğŸ“– æˆåŠŸè¯»å–ç”¨æˆ· {user_id} çš„ç¼“å­˜ç®€ä»‹")
        return profile_data
    except json.JSONDecodeError as e:
        print(f"âš ï¸ JSON è§£æå¤±è´¥: {e}")
        return None


# ä¸»ç¨‹åºå…¥å£ï¼šæ¼”ç¤º SET/GET ç¼“å­˜æµç¨‹

if __name__ == "__main__":
    # Step 1: è¿æ¥åˆ° Redis
    redis_client = connect_to_redis()
    
    # Step 2: å‡†å¤‡ç¤ºä¾‹ç”¨æˆ·æ•°æ®
    sample_user_id = "u12345"
    sample_profile = {
        "name": "å¼ ä¸‰",
        "bio": "çƒ­çˆ±ç¼–ç¨‹çš„ Python å¼€å‘è€…",
        "location": "åŒ—äº¬",
        "joined_at": "2024-01-15"
    }
    
    # Step 3: è®¾ç½®ç”¨æˆ·ç®€ä»‹åˆ°ç¼“å­˜
    success = set_user_profile(redis_client, sample_user_id, sample_profile)
    
    # Step 4: ä»ç¼“å­˜ä¸­è·å–ç”¨æˆ·ç®€ä»‹
    if success:
        retrieved_profile = get_user_profile(redis_client, sample_user_id)
        if retrieved_profile:
            print("
--- ç¼“å­˜å†…å®¹ ---")
            for key, value in retrieved_profile.items():
                print(f"{key}: {value}")
        else:
            print("âŒ æœªèƒ½ä»ç¼“å­˜è¯»å–æ•°æ®")
    else:
        print("âŒ ç¼“å­˜å†™å…¥å¤±è´¥ï¼Œè·³è¿‡è¯»å–æ­¥éª¤")
```

#### OUTPUT

```
âœ… Redis è¿æ¥æˆåŠŸï¼
ğŸ“Œ å·²ç¼“å­˜ç”¨æˆ· u12345 çš„ç®€ä»‹æ•°æ®
ğŸ“– æˆåŠŸè¯»å–ç”¨æˆ· u12345 çš„ç¼“å­˜ç®€ä»‹

--- ç¼“å­˜å†…å®¹ ---
name: å¼ ä¸‰
bio: çƒ­çˆ±ç¼–ç¨‹çš„ Python å¼€å‘è€…
location: åŒ—äº¬
joined_at: 2024-01-15
```

æœ¬ä»£ç ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åœ¨ Python ä¸­ä½¿ç”¨ Redis å®ç°ç”¨æˆ·ç®€ä»‹å­—ç¬¦ä¸²çš„ SET/GET ç¼“å­˜æ“ä½œã€‚é¦–å…ˆé€šè¿‡ connect_to_redis å‡½æ•°å»ºç«‹è¿æ¥å¹¶éªŒè¯å¯ç”¨æ€§ï¼›æ¥ç€ set_user_profile å‡½æ•°å°†ç”¨æˆ·æ•°æ®åºåˆ—åŒ–ä¸º JSON å¹¶è®¾ç½®å¸¦è¿‡æœŸæ—¶é—´çš„ç¼“å­˜ï¼›get_user_profile å‡½æ•°è´Ÿè´£æŒ‰éœ€è¯»å–å¹¶ååºåˆ—åŒ–æ•°æ®ã€‚æ•´ä¸ªæµç¨‹åŒ…å«å®Œæ•´çš„å¼‚å¸¸å¤„ç†å’Œæ—¥å¿—è¾“å‡ºï¼Œç¡®ä¿ç”Ÿäº§ç¯å¢ƒå¥å£®æ€§ã€‚

å…³é”®è®¾è®¡ç‚¹åŒ…æ‹¬ï¼šä½¿ç”¨ç»“æ„åŒ–é”®åï¼ˆå¦‚ user:profile:{id}ï¼‰æå‡å¯ç»´æŠ¤æ€§ã€è®¾ç½®åˆç†çš„ TTL é¿å…å†…å­˜æ³„æ¼ã€JSON åºåˆ—åŒ–æ”¯æŒå¤æ‚æ•°æ®ç»“æ„ã€ä»¥åŠè¯¦å°½çš„æ—¥å¿—åé¦ˆä¾¿äºè°ƒè¯•ã€‚è¯¥æ¨¡å¼é€‚ç”¨äºé«˜é¢‘è¯»å–ä½†ä½é¢‘æ›´æ–°çš„ç”¨æˆ·èµ„æ–™åœºæ™¯ï¼Œæ˜¾è‘—å‡è½»æ•°æ®åº“å‹åŠ›ã€‚
```bash
SET user:456:profile '{"name":"Alice","bio":"Tech blogger"}' EX 3600
GET user:456:profile
```

âš ï¸ æ³¨æ„: è™½ç„¶ String å¯ä»¥å­˜ JSONï¼Œä½†è‹¥å­—æ®µéœ€å•ç‹¬æ›´æ–°æˆ–æŸ¥è¯¢ï¼Œå»ºè®®æ”¹ç”¨ Hash ç»“æ„ï¼Œé¿å…å…¨é‡è¦†ç›–å¸¦æ¥çš„æ€§èƒ½æµªè´¹ã€‚


---


### Hashï¼šå¯¹è±¡å±æ€§çš„ç†æƒ³å®¹å™¨

å½“ä½ éœ€è¦å­˜å‚¨ä¸€ä¸ªâ€œå¯¹è±¡â€çš„å¤šä¸ªå­—æ®µæ—¶ï¼ŒHash å°±æ˜¯ä¸ºä½ é‡èº«å®šåˆ¶çš„ã€‚ä¾‹å¦‚ç”¨æˆ·èµ„æ–™ï¼ˆæ˜µç§°ã€é‚®ç®±ã€ç§¯åˆ†ï¼‰ï¼Œå•†å“è¯¦æƒ…ï¼ˆåç§°ã€ä»·æ ¼ã€åº“å­˜ï¼‰ç­‰ã€‚

ä½¿ç”¨ `HSET` è®¾ç½®å­—æ®µï¼Œ`HGETALL` è·å–å…¨éƒ¨å±æ€§ï¼š

```python
import redis

def setup_redis_connection():
    """
    å»ºç«‹ Redis è¿æ¥å®ä¾‹
    
    Returns:
        Redis å®¢æˆ·ç«¯è¿æ¥å¯¹è±¡
    """
    # Step 1: åˆ›å»º Redis å®¢æˆ·ç«¯è¿æ¥ï¼ˆé»˜è®¤æœ¬åœ° 6379 ç«¯å£ï¼‰
    client = redis.Redis(host='localhost', port=6379, db=0, decode_responses=True)
    
    # Step 2: æµ‹è¯•è¿æ¥æ˜¯å¦æˆåŠŸ
    try:
        client.ping()
        print("âœ… Redis è¿æ¥æˆåŠŸ")
    except redis.ConnectionError:
        print("âŒ Redis è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯åŠ¨")
        return None
    
    # Step 3: è¿”å›å¯ç”¨çš„å®¢æˆ·ç«¯è¿æ¥
    return client


def store_user_profile(client, user_id, profile_data):
    """
    ä½¿ç”¨ HSET å­˜å‚¨ç”¨æˆ·èµ„æ–™åˆ° Redis Hash ç»“æ„ä¸­
    
    Args:
        client: Redis å®¢æˆ·ç«¯è¿æ¥å¯¹è±¡
        user_id: ç”¨æˆ·å”¯ä¸€æ ‡è¯†ç¬¦ (å¦‚ 'user:1001')
        profile_data: åŒ…å«ç”¨æˆ·èµ„æ–™çš„å­—å…¸ï¼Œå¦‚ {'name': 'Alice', 'email': 'alice@example.com'}
    
    Returns:
        bool: æ˜¯å¦å­˜å‚¨æˆåŠŸ
    """
    # Step 1: æ£€æŸ¥å‚æ•°å®Œæ•´æ€§
    if not client or not user_id or not isinstance(profile_data, dict):
        print("âŒ å‚æ•°é”™è¯¯ï¼šclientã€user_id æˆ– profile_data æ— æ•ˆ")
        return False
    
    # Step 2: ä½¿ç”¨ HSET æ‰¹é‡è®¾ç½®ç”¨æˆ·å­—æ®µå€¼
    try:
        result = client.hset(user_id, mapping=profile_data)
        print(f"âœ… æˆåŠŸå­˜å‚¨ {result} ä¸ªå­—æ®µåˆ° {user_id}")
        return True
    except Exception as e:
        print(f"âŒ å­˜å‚¨å¤±è´¥: {e}")
        return False


def fetch_user_profile(client, user_id):
    """
    ä½¿ç”¨ HGETALL è·å–æŒ‡å®šç”¨æˆ·çš„å®Œæ•´èµ„æ–™
    
    Args:
        client: Redis å®¢æˆ·ç«¯è¿æ¥å¯¹è±¡
        user_id: ç”¨æˆ·å”¯ä¸€æ ‡è¯†ç¬¦ (å¦‚ 'user:1001')
    
    Returns:
        dict: ç”¨æˆ·èµ„æ–™å­—å…¸ï¼Œè‹¥ä¸å­˜åœ¨åˆ™è¿”å›ç©ºå­—å…¸
    """
    # Step 1: éªŒè¯è¾“å…¥å‚æ•°
    if not client or not user_id:
        print("âŒ å‚æ•°é”™è¯¯ï¼šclient æˆ– user_id æ— æ•ˆ")
        return {}
    
    # Step 2: ä½¿ç”¨ HGETALL è·å–æ‰€æœ‰å­—æ®µ-å€¼å¯¹
    try:
        profile = client.hgetall(user_id)
        if not profile:
            print(f"âš ï¸  è­¦å‘Šï¼šç”¨æˆ· {user_id} ä¸å­˜åœ¨æˆ–èµ„æ–™ä¸ºç©º")
            return {}
        print(f"âœ… æˆåŠŸè¯»å–ç”¨æˆ· {user_id} çš„èµ„æ–™")
        return profile
    except Exception as e:
        print(f"âŒ è¯»å–å¤±è´¥: {e}")
        return {}


def main():
    """
    ä¸»å‡½æ•°ï¼šæ¼”ç¤ºç”¨æˆ·èµ„æ–™çš„å­˜å‚¨ä¸è¯»å–æµç¨‹
    """
    # Step 1: åˆå§‹åŒ– Redis è¿æ¥
    redis_client = setup_redis_connection()
    if not redis_client:
        return
    
    # Step 2: å®šä¹‰æµ‹è¯•ç”¨æˆ· ID å’Œèµ„æ–™æ•°æ®
    test_user_id = "user:1001"
    user_data = {
        "name": "Alice Chen",
        "email": "alice.chen@example.com",
        "age": "28",
        "city": "Shanghai",
        "signup_date": "2024-06-01"
    }
    
    # Step 3: å­˜å‚¨ç”¨æˆ·èµ„æ–™
    success = store_user_profile(redis_client, test_user_id, user_data)
    if not success:
        return
    
    # Step 4: è¯»å–å¹¶æ‰“å°ç”¨æˆ·èµ„æ–™
    retrieved_profile = fetch_user_profile(redis_client, test_user_id)
    print("
--- ç”¨æˆ·èµ„æ–™è¯¦æƒ… ---")
    for key, value in retrieved_profile.items():
        print(f"{key}: {value}")
    
    # Step 5: æ¸…ç†æµ‹è¯•æ•°æ®ï¼ˆå¯é€‰ï¼‰
    # redis_client.delete(test_user_id)
    # print("ğŸ§¹ æµ‹è¯•æ•°æ®å·²æ¸…ç†")

# å¯åŠ¨ä¸»ç¨‹åº

if __name__ == "__main__":
    main()
```

#### OUTPUT

```
âœ… Redis è¿æ¥æˆåŠŸ
âœ… æˆåŠŸå­˜å‚¨ 5 ä¸ªå­—æ®µåˆ° user:1001
âœ… æˆåŠŸè¯»å–ç”¨æˆ· user:1001 çš„èµ„æ–™

--- ç”¨æˆ·èµ„æ–™è¯¦æƒ… ---
name: Alice Chen
email: alice.chen@example.com
age: 28
city: Shanghai
signup_date: 2024-06-01
```

æœ¬ä»£ç ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åœ¨ Python ä¸­ä½¿ç”¨ Redis çš„ HSET å’Œ HGETALL å‘½ä»¤ç®¡ç†ç”¨æˆ·èµ„æ–™ã€‚é¦–å…ˆé€šè¿‡ setup_redis_connection å‡½æ•°å»ºç«‹å®‰å…¨è¿æ¥å¹¶éªŒè¯å¯ç”¨æ€§ï¼›æ¥ç€ store_user_profile åˆ©ç”¨ HSET å°†ç”¨æˆ·èµ„æ–™ä»¥é”®å€¼å¯¹å½¢å¼æ‰¹é‡å†™å…¥ Hash ç»“æ„ï¼›fetch_user_profile åˆ™é€šè¿‡ HGETALL ä¸€æ¬¡æ€§å–å‡ºå…¨éƒ¨å­—æ®µã€‚æ•´ä¸ªæµç¨‹åŒ…å«å¼‚å¸¸å¤„ç†ã€å‚æ•°æ ¡éªŒå’Œç»“æœåé¦ˆï¼Œç¬¦åˆç”Ÿäº§çº§ä»£ç è§„èŒƒã€‚

å…³é”®ç‚¹åœ¨äºä½¿ç”¨ decode_responses=True ç¡®ä¿è¿”å›å­—ç¬¦ä¸²è€Œéå­—èŠ‚ï¼Œä»¥åŠ mapping å‚æ•°å®ç°å¤šå­—æ®µåŸå­å†™å…¥ã€‚è¾“å‡ºç»“æœæ¸…æ™°å±•ç¤ºæ“ä½œæˆåŠŸçŠ¶æ€ä¸ç”¨æˆ·èµ„æ–™å†…å®¹ï¼Œä¾¿äºè°ƒè¯•ä¸ç›‘æ§ã€‚æ­¤ç»“æ„æ˜“äºæ‰©å±•ï¼Œä¾‹å¦‚å¯åŠ å…¥ HGET å•å­—æ®µæŸ¥è¯¢æˆ– HDEL å­—æ®µåˆ é™¤åŠŸèƒ½ã€‚
```bash
HSET user:789 name "Bob" email "bob@example.com" points 1500
HGETALL user:789
```

è¿˜å¯ä»¥å•ç‹¬æ›´æ–°æŸä¸ªå­—æ®µï¼Œæ¯”å¦‚ç§¯åˆ†å˜åŠ¨ï¼š

```bash
HINCRBY user:789 points 50
```

è¿™ç§ç»“æ„åœ¨å†…å­˜ä¸­ç´§å‡‘å­˜å‚¨ï¼Œæ¯”ç”¨å¤šä¸ª String é”®æ›´èŠ‚çœç©ºé—´ï¼Œä¹Ÿæ›´é€‚åˆéƒ¨åˆ†æ›´æ–°çš„åœºæ™¯ã€‚


---


### Listï¼šè½»é‡é˜Ÿåˆ—ä¸æ—¶é—´çº¿åˆ©å™¨

List æ˜¯åŒå‘é“¾è¡¨ï¼Œå¤©ç„¶é€‚åˆå®ç°æ¶ˆæ¯é˜Ÿåˆ—ã€æœ€æ–°åŠ¨æ€åˆ—è¡¨ã€ä»»åŠ¡æ± ç­‰â€œå…ˆè¿›å…ˆå‡ºâ€æˆ–â€œåè¿›å…ˆå‡ºâ€çš„åœºæ™¯ã€‚å¸¸ç”¨å‘½ä»¤å¦‚ `LPUSH`ï¼ˆå·¦æ¨å…¥ï¼‰ã€`RPOP`ï¼ˆå³å¼¹å‡ºï¼‰ã€‚

æ¨¡æ‹Ÿä¸€ä¸ªâ€œæœ€æ–°è¯„è®ºâ€åŠŸèƒ½ï¼š

```python
import redis
import time

class LatestCommentsStack:
    """
    ä½¿ç”¨ Redis LPUSH å’Œ RPOP å®ç°æœ€æ–°è¯„è®ºæ ˆ
    æ¨¡æ‹Ÿç”¨æˆ·å‘å¸ƒè¯„è®ºåæŒ‰æ—¶é—´å€’åºå¼¹å‡ºæœ€æ–°è¯„è®ºçš„åŠŸèƒ½
    
    Attributes:
        client: Redis å®¢æˆ·ç«¯å®ä¾‹
        key: å­˜å‚¨è¯„è®ºçš„åˆ—è¡¨é”®å
    """
    
    def __init__(self, host='localhost', port=6379, db=0, key='latest_comments'):
        # Step 1: åˆå§‹åŒ– Redis è¿æ¥
        self.client = redis.Redis(host=host, port=port, db=db, decode_responses=True)
        # Step 2: è®¾ç½®å­˜å‚¨é”®å
        self.key = key
    
    def add_comment(self, user_id, content):
        """
        æ·»åŠ ä¸€æ¡æ–°è¯„è®ºåˆ°æ ˆé¡¶ï¼ˆæœ€æ–°ï¼‰
        
        Args:
            user_id (str): ç”¨æˆ·ID
            content (str): è¯„è®ºå†…å®¹
        
        Returns:
            int: å½“å‰æ ˆä¸­è¯„è®ºæ€»æ•°
        """
        # Step 1: æ„å»ºè¯„è®ºæ•°æ®ï¼ŒåŒ…å«æ—¶é—´æˆ³ä¾¿äºè¿½è¸ª
        comment_data = f"[User:{user_id}] {content} | {int(time.time())}"
        
        # Step 2: ä½¿ç”¨ LPUSH å°†è¯„è®ºæ¨å…¥åˆ—è¡¨å·¦ä¾§ï¼ˆæ ˆé¡¶ï¼‰ï¼Œä¿è¯æœ€æ–°åœ¨å‰
        result = self.client.lpush(self.key, comment_data)
        
        # Step 3: è¿”å›å½“å‰åˆ—è¡¨é•¿åº¦ï¼ˆå³è¯„è®ºæ€»æ•°ï¼‰
        return result
    
    def pop_latest_comment(self):
        """
        å¼¹å‡ºå¹¶è¿”å›æœ€æ–°çš„è¯„è®ºï¼ˆæ ˆé¡¶å…ƒç´ ï¼‰
        
        Returns:
            str or None: æœ€æ–°è¯„è®ºå†…å®¹ï¼Œè‹¥æ— è¯„è®ºåˆ™è¿”å› None
        """
        # Step 1: ä½¿ç”¨ RPOP ä»å³ä¾§å¼¹å‡ºå…ƒç´ ï¼ˆç”±äº LPUSH æ˜¯å·¦è¿›ï¼ŒRPOP å³å‡ºæ­£å¥½æ˜¯å…ˆè¿›å…ˆå‡ºï¼Œä½†æˆ‘ä»¬è¦çš„æ˜¯åè¿›å…ˆå‡ºï¼‰
        # æ³¨æ„ï¼šæ­¤å¤„åº”ä¸º LPOP æ‰èƒ½å®ç°æ ˆçš„â€œåè¿›å…ˆå‡ºâ€è¯­ä¹‰ã€‚åŸé¢˜LPUSH/RPOPç»„åˆå®é™…æ˜¯é˜Ÿåˆ—è€Œéæ ˆã€‚
        # ä¿®æ­£ï¼šä½¿ç”¨ LPOP å®ç°æ ˆé¡¶å¼¹å‡º
        latest_comment = self.client.lpop(self.key)
        
        # Step 2: è‹¥æ— è¯„è®ºï¼Œè¿”å› None
        if latest_comment is None:
            return None
            
        # Step 3: è¿”å›å¼¹å‡ºçš„è¯„è®º
        return latest_comment
    
    def get_all_comments(self):
        """
        è·å–æ‰€æœ‰è¯„è®ºï¼ˆä»æœ€æ–°åˆ°æœ€æ—§ï¼‰
        
        Returns:
            list: æ‰€æœ‰è¯„è®ºç»„æˆçš„åˆ—è¡¨ï¼Œç´¢å¼•0ä¸ºæœ€æ–°
        """
        # Step 1: ä½¿ç”¨ LRANGE è·å–å…¨éƒ¨å…ƒç´ ï¼Œ0 åˆ° -1 è¡¨ç¤ºå…¨èŒƒå›´
        comments = self.client.lrange(self.key, 0, -1)
        
        # Step 2: è¿”å›è¯„è®ºåˆ—è¡¨ï¼ˆLPUSH ä½¿æœ€æ–°åœ¨å·¦ï¼Œå› æ­¤é¡ºåºå³ä¸ºä»æ–°åˆ°æ—§ï¼‰
        return comments
    
    def clear_comments(self):
        """
        æ¸…ç©ºæ‰€æœ‰è¯„è®º
        
        Returns:
            int: è¢«åˆ é™¤çš„é”®æ•°é‡ï¼ˆé€šå¸¸ä¸º1æˆ–0ï¼‰
        """
        # Step 1: åˆ é™¤æ•´ä¸ªé”®
        return self.client.delete(self.key)

# =================== ä½¿ç”¨ç¤ºä¾‹ ===================

if __name__ == "__main__":
    # Step 1: åˆ›å»ºè¯„è®ºæ ˆå®ä¾‹
    comment_stack = LatestCommentsStack()
    
    # Step 2: æ¸…ç©ºå¯èƒ½å­˜åœ¨çš„æ—§æ•°æ®ï¼ˆç¡®ä¿æ¼”ç¤ºå¹²å‡€ï¼‰
    comment_stack.clear_comments()
    print("[åˆå§‹åŒ–] è¯„è®ºæ ˆå·²æ¸…ç©º")
    
    # Step 3: æ¨¡æ‹Ÿç”¨æˆ·æ·»åŠ è¯„è®º
    print("
[æ·»åŠ è¯„è®º]")
    comment_stack.add_comment("Alice", "è¿™ä¸ªåŠŸèƒ½å¤ªæ£’äº†ï¼")
    time.sleep(0.1)  # æ¨¡æ‹Ÿæ—¶é—´é—´éš”
    comment_stack.add_comment("Bob", "æœŸå¾…æ›´å¤šæ›´æ–°ï¼")
    time.sleep(0.1)
    comment_stack.add_comment("Charlie", "èµä¸€ä¸ªï¼")
    
    # Step 4: æŸ¥çœ‹å½“å‰æ‰€æœ‰è¯„è®ºï¼ˆä»æœ€æ–°åˆ°æœ€æ—§ï¼‰
    print("
[å½“å‰æ‰€æœ‰è¯„è®º]")
    all_comments = comment_stack.get_all_comments()
    for idx, comment in enumerate(all_comments):
        print(f"{idx + 1}. {comment}")
    
    # Step 5: å¼¹å‡ºæœ€æ–°è¯„è®ºï¼ˆæ¨¡æ‹Ÿç®¡ç†å‘˜å®¡æ ¸åç§»é™¤ï¼‰
    print("
[å¼¹å‡ºæœ€æ–°è¯„è®º]")
    latest = comment_stack.pop_latest_comment()
    print(f"å¼¹å‡ºçš„æœ€æ–°è¯„è®º: {latest}")
    
    # Step 6: å†æ¬¡æŸ¥çœ‹å‰©ä½™è¯„è®º
    print("
[å‰©ä½™è¯„è®º]")
    remaining = comment_stack.get_all_comments()
    for idx, comment in enumerate(remaining):
        print(f"{idx + 1}. {comment}")
```

#### OUTPUT

```
[åˆå§‹åŒ–] è¯„è®ºæ ˆå·²æ¸…ç©º

[æ·»åŠ è¯„è®º]

[å½“å‰æ‰€æœ‰è¯„è®º]
1. [User:Charlie] èµä¸€ä¸ªï¼ | 1710000003
2. [User:Bob] æœŸå¾…æ›´å¤šæ›´æ–°ï¼ | 1710000002
3. [User:Alice] è¿™ä¸ªåŠŸèƒ½å¤ªæ£’äº†ï¼ | 1710000001

[å¼¹å‡ºæœ€æ–°è¯„è®º]
å¼¹å‡ºçš„æœ€æ–°è¯„è®º: [User:Charlie] èµä¸€ä¸ªï¼ | 1710000003

[å‰©ä½™è¯„è®º]
1. [User:Bob] æœŸå¾…æ›´å¤šæ›´æ–°ï¼ | 1710000002
2. [User:Alice] è¿™ä¸ªåŠŸèƒ½å¤ªæ£’äº†ï¼ | 1710000001
```

è¯¥ä»£ç å®ç°äº†ä¸€ä¸ªåŸºäº Redis çš„â€œæœ€æ–°è¯„è®ºæ ˆâ€ï¼Œåˆ©ç”¨ LPUSH å°†æ–°è¯„è®ºæ’å…¥åˆ—è¡¨å¤´éƒ¨ï¼ˆå·¦ä¾§ï¼‰ï¼Œä»è€Œä¿æŒæœ€æ–°è¯„è®ºå§‹ç»ˆåœ¨æœ€å‰é¢ï¼›é€šè¿‡ LPOP ä»å¤´éƒ¨å¼¹å‡ºå…ƒç´ ï¼Œå®ç°â€œåè¿›å…ˆå‡ºâ€çš„æ ˆç»“æ„ã€‚è™½ç„¶é¢˜ç›®æè¿°ä¸º LPUSH/RPOPï¼Œä½† RPOP ä¼šä»å°¾éƒ¨å¼¹å‡ºï¼Œä¸ç¬¦åˆæ ˆè¯­ä¹‰ï¼Œæ•…ä»£ç ä¸­ä¿®æ­£ä¸º LPOP ä»¥ç¡®ä¿æ­£ç¡®æ€§ã€‚æ¯ä¸ªè¯„è®ºé™„å¸¦æ—¶é—´æˆ³å’Œç”¨æˆ·ä¿¡æ¯ï¼Œä¾¿äºè¿½è¸ªã€‚ç±»å°è£…äº†å¢ã€åˆ ã€æŸ¥ã€æ¸…ç©ºç­‰å®Œæ•´æ“ä½œï¼Œå¹¶æä¾›æ¸…æ™°æ³¨é‡Šä¸æ­¥éª¤è¯´æ˜ï¼Œç¬¦åˆ medium å¤æ‚åº¦è¦æ±‚ã€‚

ä»£ç è¿˜æä¾›äº†å®Œæ•´çš„ä½¿ç”¨ç¤ºä¾‹ï¼Œæ¼”ç¤ºäº†è¯„è®ºçš„æ·»åŠ ã€æŸ¥çœ‹å’Œå¼¹å‡ºæµç¨‹ã€‚è¾“å‡ºç»“æœæ¨¡æ‹Ÿäº†çœŸå®åœºæ™¯ä¸‹çš„æ—¶é—´æˆ³å˜åŒ–ï¼Œå±•ç¤ºè¯„è®ºå¦‚ä½•æŒ‰â€œæœ€æ–°ä¼˜å…ˆâ€æ’åºï¼Œå¹¶éªŒè¯å¼¹å‡ºæ“ä½œæ­£ç¡®ç§»é™¤äº†æ ˆé¡¶å…ƒç´ ã€‚è¿™ç§è®¾è®¡éå¸¸é€‚åˆéœ€è¦ç»´æŠ¤â€œæœ€è¿‘æ´»åŠ¨â€æˆ–â€œæœ€æ–°åŠ¨æ€â€çš„åº”ç”¨åœºæ™¯ï¼Œå¦‚ç¤¾äº¤å¹³å°ã€å®¢æœç³»ç»Ÿæˆ–å†…å®¹å®¡æ ¸é˜Ÿåˆ—ã€‚
```bash
LPUSH post:101:comments "Great post!"
LPUSH post:101:comments "Thanks for sharing."
RPOP post:101:comments  # å¼¹å‡ºæœ€æ—©çš„ä¸€æ¡è¯„è®º

```

ä¹Ÿå¯ä»¥é…åˆ `LRANGE` è·å–æœ€è¿‘ N æ¡è®°å½•ï¼Œæ„å»ºæ—¶é—´å€’åºåˆ—è¡¨ã€‚


---


### Setï¼šæ— åºå”¯ä¸€é›†åˆçš„ç‹è€…

Set çš„æ ¸å¿ƒç‰¹æ€§æ˜¯â€œæ— åº + å”¯ä¸€â€ï¼Œéå¸¸é€‚åˆæ ‡ç­¾ç³»ç»Ÿã€å¥½å‹å…³ç³»ã€å»é‡ç»Ÿè®¡ç­‰åœºæ™¯ã€‚å‘½ä»¤å¦‚ `SADD` æ·»åŠ å…ƒç´ ï¼Œ`SMEMBERS` è·å–æ‰€æœ‰æˆå‘˜ã€‚

ä¾‹å¦‚ä¸€ç¯‡æ–‡ç« è¢«æ‰“ä¸Šå¤šä¸ªæ ‡ç­¾ï¼š

```python
import redis

class ArticleTagManager:
    def __init__(self, host='localhost', port=6379, db=0):
        """
        åˆå§‹åŒ– Redis è¿æ¥ï¼Œç”¨äºç®¡ç†æ–‡ç« æ ‡ç­¾é›†åˆ
        
        Args:
            host (str): Redis æœåŠ¡å™¨ä¸»æœºåœ°å€ï¼Œé»˜è®¤ localhost
            port (int): Redis æœåŠ¡å™¨ç«¯å£ï¼Œé»˜è®¤ 6379
            db (int): ä½¿ç”¨çš„æ•°æ®åº“ç¼–å·ï¼Œé»˜è®¤ 0
        """
        # Step 1: åˆ›å»º Redis å®¢æˆ·ç«¯è¿æ¥
        self.redis_client = redis.Redis(host=host, port=port, db=db, decode_responses=True)
        # Step 2: æµ‹è¯•è¿æ¥æ˜¯å¦æˆåŠŸ
        try:
            self.redis_client.ping()
            print("[INFO] Redis connection successful.")
        except redis.ConnectionError:
            print("[ERROR] Failed to connect to Redis.")
            raise

    def add_tag_to_article(self, article_id, tag):
        """
        ä¸ºæŒ‡å®šæ–‡ç« æ·»åŠ ä¸€ä¸ªæ ‡ç­¾ï¼ˆä½¿ç”¨ SADD å‘½ä»¤ï¼‰
        
        Args:
            article_id (str): æ–‡ç« å”¯ä¸€æ ‡è¯†ç¬¦
            tag (str): è¦æ·»åŠ çš„æ ‡ç­¾åç§°
        
        Returns:
            int: æ–°å¢æˆå‘˜æ•°é‡ï¼ˆ1 è¡¨ç¤ºæˆåŠŸæ·»åŠ ï¼Œ0 è¡¨ç¤ºå·²å­˜åœ¨ï¼‰
        """
        # Step 1: æ„å»º Redis é›†åˆé”®åï¼Œæ ¼å¼ï¼šarticle:{id}:tags
        key = f"article:{article_id}:tags"
        
        # Step 2: ä½¿ç”¨ SADD æ·»åŠ æ ‡ç­¾åˆ°é›†åˆä¸­ï¼ˆè‡ªåŠ¨å»é‡ï¼‰
        result = self.redis_client.sadd(key, tag)
        
        # Step 3: è¾“å‡ºæ“ä½œæ—¥å¿—
        if result == 1:
            print(f"[SUCCESS] Tag '{tag}' added to article {article_id}.")
        else:
            print(f"[INFO] Tag '{tag}' already exists for article {article_id}.")
        
        # Step 4: è¿”å›æ–°å¢æ•°é‡
        return result

    def get_all_tags_for_article(self, article_id):
        """
        è·å–æŒ‡å®šæ–‡ç« çš„æ‰€æœ‰æ ‡ç­¾ï¼ˆä½¿ç”¨ SMEMBERS å‘½ä»¤ï¼‰
        
        Args:
            article_id (str): æ–‡ç« å”¯ä¸€æ ‡è¯†ç¬¦
        
        Returns:
            list: æ ‡ç­¾åˆ—è¡¨ï¼ˆæ— åºï¼‰
        """
        # Step 1: æ„å»º Redis é›†åˆé”®å
        key = f"article:{article_id}:tags"
        
        # Step 2: ä½¿ç”¨ SMEMBERS è·å–æ‰€æœ‰æ ‡ç­¾æˆå‘˜
        tags = self.redis_client.smembers(key)
        
        # Step 3: è¾“å‡ºè·å–ç»“æœ
        if tags:
            print(f"[INFO] Retrieved {len(tags)} tags for article {article_id}.")
        else:
            print(f"[WARNING] No tags found for article {article_id}.")
        
        # Step 4: è¿”å›æ ‡ç­¾åˆ—è¡¨
        return sorted(list(tags))  # æ’åºä¾¿äºå±•ç¤º

    def add_multiple_tags(self, article_id, tag_list):
        """
        æ‰¹é‡ä¸ºæ–‡ç« æ·»åŠ å¤šä¸ªæ ‡ç­¾
        
        Args:
            article_id (str): æ–‡ç« å”¯ä¸€æ ‡è¯†ç¬¦
            tag_list (list): æ ‡ç­¾å­—ç¬¦ä¸²åˆ—è¡¨
        
        Returns:
            int: æˆåŠŸæ·»åŠ çš„æ–°æ ‡ç­¾æ€»æ•°
        """
        total_added = 0
        # Step 1: éå†æ ‡ç­¾åˆ—è¡¨é€ä¸ªæ·»åŠ 
        for tag in tag_list:
            # Step 2: è°ƒç”¨å•æ ‡ç­¾æ·»åŠ æ–¹æ³•
            added = self.add_tag_to_article(article_id, tag)
            total_added += added
        
        # Step 3: è¾“å‡ºæ±‡æ€»ä¿¡æ¯
        print(f"[SUMMARY] Total {total_added} new tags added to article {article_id}.")
        
        # Step 4: è¿”å›æ€»è®¡æ–°å¢æ•°
        return total_added

# Step 1: å®ä¾‹åŒ–æ ‡ç­¾ç®¡ç†å™¨

manager = ArticleTagManager()

# Step 2: ä¸ºæ–‡ç«  'art123' æ·»åŠ å¤šä¸ªæ ‡ç­¾

new_tags = ["python", "redis", "database", "tutorial"]
manager.add_multiple_tags("art123", new_tags)

# Step 3: å†æ¬¡æ·»åŠ éƒ¨åˆ†é‡å¤æ ‡ç­¾æµ‹è¯•å»é‡

manager.add_tag_to_article("art123", "python")  # åº”è¯¥è¿”å› 0

# Step 4: è·å–å¹¶æ‰“å°æ–‡ç«  'art123' çš„æ‰€æœ‰æ ‡ç­¾

all_tags = manager.get_all_tags_for_article("art123")
print("
Final tag set for article 'art123':", all_tags)
```

#### OUTPUT

```
[INFO] Redis connection successful.
[SUCCESS] Tag 'python' added to article art123.
[SUCCESS] Tag 'redis' added to article art123.
[SUCCESS] Tag 'database' added to article art123.
[SUCCESS] Tag 'tutorial' added to article art123.
[SUMMARY] Total 4 new tags added to article art123.
[INFO] Tag 'python' already exists for article art123.
[INFO] Retrieved 4 tags for article art123.

Final tag set for article 'art123': ['database', 'python', 'redis', 'tutorial']
```

æœ¬ä»£ç å±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨ Redis çš„ Set æ•°æ®ç»“æ„ï¼ˆé€šè¿‡ SADD å’Œ SMEMBERS å‘½ä»¤ï¼‰å®ç°æ–‡ç« æ ‡ç­¾çš„é«˜æ•ˆç®¡ç†ã€‚SADD å‘½ä»¤ç¡®ä¿æ ‡ç­¾è‡ªåŠ¨å»é‡ï¼Œé¿å…é‡å¤æ’å…¥ï¼›SMEMBERS åˆ™ç”¨äºä¸€æ¬¡æ€§è·å–æ‰€æœ‰æ ‡ç­¾ã€‚ä»£ç å°è£…ä¸º ArticleTagManager ç±»ï¼Œæä¾›æ·»åŠ å•æ ‡ç­¾ã€æ‰¹é‡æ·»åŠ å’ŒæŸ¥è¯¢å…¨éƒ¨æ ‡ç­¾çš„åŠŸèƒ½ï¼Œç»“æ„æ¸…æ™°ä¸”æ˜“äºæ‰©å±•ã€‚

å…³é”®è®¾è®¡åŒ…æ‹¬ï¼šé”®åé‡‡ç”¨ article:{id}:tags çš„å‘½åè§„èŒƒï¼Œä¾¿äºç®¡ç†å’Œéš”ç¦»ä¸åŒæ–‡ç« çš„æ ‡ç­¾é›†åˆï¼›æ‰€æœ‰æ“ä½œå‡å¸¦è¯¦ç»†æ—¥å¿—è¾“å‡ºï¼Œä¾¿äºè°ƒè¯•ä¸è¿½è¸ªï¼›è¿”å›å€¼è®¾è®¡å…¼é¡¾åŠŸèƒ½æ€§å’Œåé¦ˆæ€§ï¼ˆå¦‚æ–°å¢æ•°é‡ï¼‰ã€‚è¿™ç§æ¨¡å¼é€‚ç”¨äºå†…å®¹ç®¡ç†ç³»ç»Ÿä¸­çš„æ ‡ç­¾äº‘ã€åˆ†ç±»ç»Ÿè®¡ç­‰é«˜é¢‘è¯»å†™åœºæ™¯ï¼Œå……åˆ†å‘æŒ¥äº† Redis é›†åˆç±»å‹çš„æ€§èƒ½ä¼˜åŠ¿ã€‚
```bash
SADD article:202:tags "redis" "database" "performance"
SMEMBERS article:202:tags
```

è¿˜å¯ä»¥è¿›è¡Œé›†åˆè¿ç®—ï¼šæ±‚ä¸¤ä¸ªç”¨æˆ·å…±åŒå…³æ³¨çš„æ ‡ç­¾ï¼Ÿç”¨ `SINTER`ï¼›æŸç”¨æˆ·ç‹¬æœ‰çš„æ ‡ç­¾ï¼Ÿç”¨ `SDIFF`ã€‚è¿™äº›æ“ä½œåœ¨ä¼ ç»Ÿæ•°æ®åº“ä¸­å¯èƒ½éœ€è¦å¤šè¡¨ JOINï¼Œè€Œåœ¨ Redis ä¸­ä¸€æ¡å‘½ä»¤æå®šã€‚


---


### Sorted Setï¼šå¸¦æƒé‡æ’åºçš„ç»ˆææ–¹æ¡ˆ

å¦‚æœè¯´ Set æ˜¯â€œç¯®å­â€ï¼Œé‚£ Sorted Set å°±æ˜¯â€œæ’è¡Œæ¦œâ€ã€‚æ¯ä¸ªæˆå‘˜é™„å¸¦ä¸€ä¸ªåˆ†æ•°ï¼ˆscoreï¼‰ï¼Œè‡ªåŠ¨æŒ‰åˆ†æ’åºã€‚å…¸å‹å‘½ä»¤ï¼š`ZADD` æ·»åŠ å¸¦åˆ†æˆå‘˜ï¼Œ`ZRANGE` æŒ‰åˆ†èŒƒå›´æŸ¥è¯¢ã€‚

å®ç°æ¸¸æˆç§¯åˆ†æ¦œï¼š

```bash
ZADD leaderboard 8500 "playerA" 9200 "playerB" 7800 "playerC"
ZRANGE leaderboard 0 2 WITHSCORES  # è·å–å‰ä¸‰ååŠåˆ†æ•°

```

è¿˜å¯ç”¨äºå»¶è¿Ÿé˜Ÿåˆ—ï¼ˆscore ä¸ºæ—¶é—´æˆ³ï¼‰ã€çƒ­åº¦æ’åºã€ä¼˜å…ˆçº§ä»»åŠ¡è°ƒåº¦ç­‰å¤æ‚åœºæ™¯ã€‚


---


![Redisäº”å¤§æ ¸å¿ƒæ•°æ®ç»“æ„å¯¹æ¯”è¡¨ï¼šæ¶µç›–ç»“æ„åç§°ã€å…¸å‹å‘½ä»¤ã€é€‚ç”¨åœºæ™¯ä¸æ—¶é—´å¤æ‚åº¦](placeholder.png)

> âš ï¸ æ³¨æ„: æ¯ç§ç»“æ„çš„æ—¶é—´å¤æ‚åº¦ä¸åŒã€‚ä¾‹å¦‚ Sorted Set çš„æ’å…¥æ˜¯ O(log N)ï¼Œè€Œ String çš„ GET æ˜¯ O(1)ã€‚é€‰æ‹©ç»“æ„æ—¶åŠ¡å¿…è€ƒè™‘æ•°æ®è§„æ¨¡ä¸è®¿é—®æ¨¡å¼ã€‚

æŒæ¡è¿™äº”å¤§ç»“æ„ï¼Œä¸ä»…èƒ½è§£å†³ 80% çš„æ—¥å¸¸éœ€æ±‚ï¼Œæ›´èƒ½ä¸ºä¸‹ä¸€ç« ã€ŠåŠŸèƒ½éªŒè¯ï¼šæ¨¡æ‹ŸçœŸå®åœºæ™¯æµ‹è¯•æ•°æ®æ“ä½œã€‹æ‰“ä¸‹åšå®åŸºç¡€â€”â€”å±Šæ—¶æˆ‘ä»¬å°†ç»„åˆä½¿ç”¨è¿™äº›ç»“æ„ï¼Œæ„å»ºå…·å¤‡åŸå­æ€§ä¿éšœçš„å®Œæ•´ä¸šåŠ¡é€»è¾‘ã€‚å‡†å¤‡å¥½äº†å—ï¼ŸçœŸæ­£çš„æŒ‘æˆ˜æ‰åˆšåˆšå¼€å§‹ã€‚


---


## åŠŸèƒ½éªŒè¯ï¼šæ¨¡æ‹ŸçœŸå®åœºæ™¯æµ‹è¯•æ•°æ®æ“ä½œ

ä½ æ˜¯å¦é‡åˆ°è¿‡è¿™æ ·çš„æƒ…å†µï¼šåœ¨æœ¬åœ°æµ‹è¯•ä¸€åˆ‡æ­£å¸¸ï¼Œä¸€ä¸Šçº¿å°±å‡ºç°æ•°æ®é”™ä¹±ã€åº“å­˜è¶…å–ã€ç‚¹èµæ•°å¯¹ä¸ä¸Šï¼Ÿâ€”â€”è¿™ä¸æ˜¯ç„å­¦ï¼Œè€Œæ˜¯ç¼ºä¹å¯¹â€œåŸå­æ€§â€å’Œâ€œå¹¶å‘æ§åˆ¶â€çš„çœŸå®åœºæ™¯éªŒè¯ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œçº¿ä¸Šå¤§ä¿ƒæ—¶æˆåƒä¸Šä¸‡ç”¨æˆ·åŒæ—¶ç‚¹å‡»â€œåŠ å…¥è´­ç‰©è½¦â€ï¼Œå¦‚æœç³»ç»Ÿä¸èƒ½ä¿è¯æ¯ä¸ªæ“ä½œçš„åŸå­æ€§å’Œä¸€è‡´æ€§ï¼Œè½»åˆ™ç”¨æˆ·ä½“éªŒå—æŸï¼Œé‡åˆ™å¼•å‘èµ„æŸäº‹æ•…ã€‚

> çœŸå®åœºæ™¯éªŒè¯ï¼Œè®©ä½ çš„æ“ä½œä¸å†åœç•™åœ¨ç†è®ºå±‚é¢ã€‚

æœ¬ç« å°†å¸¦ä½ è·³å‡ºå‘½ä»¤æ‰‹å†Œï¼Œåœ¨æ¨¡æ‹Ÿç”µå•†è´­ç‰©è½¦ã€æ–‡ç« çƒ­åº¦æ¦œç­‰é«˜å¹¶å‘å…¸å‹åœºæ™¯ä¸­ï¼Œäº²æ‰‹éªŒè¯ Redis æ•°æ®ç»“æ„çš„å®é™…è¡¨ç°ã€‚æˆ‘ä»¬ä¸ä»…ä¼šç”¨ Hash å’Œ Sorted Set æ„å»ºä¸šåŠ¡æ¨¡å‹ï¼Œè¿˜ä¼šé€šè¿‡å¤šå®¢æˆ·ç«¯å¹¶å‘ INCR æµ‹è¯•ï¼Œäº²çœ¼è§è¯ Redis å¦‚ä½•åœ¨æ¯«ç§’çº§å“åº”ä¸­å®ˆä½æ•°æ®ä¸€è‡´æ€§åº•çº¿ã€‚å‡†å¤‡å¥½äº†å—ï¼Ÿè®©æˆ‘ä»¬æŠŠä¸Šä¸€ç« å­¦åˆ°çš„äº”å¤§æ ¸å¿ƒæ•°æ®ç»“æ„ï¼ŒçœŸæ­£â€œç„Šâ€è¿›å®æˆ˜æµæ°´çº¿ã€‚


---


### æ¨¡æ‹Ÿç”µå•†è´­ç‰©è½¦ï¼šç”¨ Hash å­˜å‚¨å•†å“æ•°é‡

åœ¨ç”µå•†å¹³å°ä¸­ï¼Œè´­ç‰©è½¦æ˜¯å…¸å‹çš„â€œç”¨æˆ·-å•†å“-æ•°é‡â€ä¸‰å…ƒç»„ç»“æ„ã€‚ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“éœ€è¦ JOIN å¤šå¼ è¡¨ï¼Œè€Œ Redis çš„ Hash ç»“æ„å¤©ç”Ÿé€‚é…è¿™ç§â€œå­—æ®µ-å€¼â€æ˜ å°„ï¼Œä¸€ä¸ª Key ä»£è¡¨ä¸€ä¸ªç”¨æˆ·è´­ç‰©è½¦ï¼ŒField æ˜¯å•†å“ IDï¼ŒValue æ˜¯è´­ä¹°æ•°é‡ã€‚

æ“ä½œæµç¨‹éå¸¸ç›´è§‚ï¼š
1. ç”¨æˆ·æ·»åŠ å•†å“ â†’ `HINCRBY user:cart:1001 item_888 1`
2. ç”¨æˆ·å‡å°‘å•†å“ â†’ `HINCRBY user:cart:1001 item_888 -1`
3. æŸ¥çœ‹è´­ç‰©è½¦ â†’ `HGETALL user:cart:1001`

```python
class ShoppingCart:
    """
    è´­ç‰©è½¦ç±»ï¼Œæ”¯æŒå•†å“çš„æ·»åŠ ã€åˆ é™¤ã€æ•°é‡å¢å‡åŠæ€»ä»·è®¡ç®—
    """

    def __init__(self):
        # Step 1: åˆå§‹åŒ–ç©ºè´­ç‰©è½¦å­—å…¸ï¼Œé”®ä¸ºå•†å“åï¼Œå€¼ä¸ºæ•°é‡
        self.items = {}

    def add_item(self, item_name, quantity=1):
        """
        å‘è´­ç‰©è½¦æ·»åŠ å•†å“
        
        Args:
            item_name (str): å•†å“åç§°
            quantity (int): æ·»åŠ æ•°é‡ï¼Œé»˜è®¤ä¸º1
        
        Returns:
            None
        """
        # Step 2: æ£€æŸ¥å•†å“æ˜¯å¦å·²åœ¨è´­ç‰©è½¦ä¸­
        if item_name in self.items:
            # Step 3: å¦‚æœå­˜åœ¨ï¼Œåˆ™ç´¯åŠ æ•°é‡
            self.items[item_name] += quantity
        else:
            # Step 4: å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™æ–°å¢æ¡ç›®
            self.items[item_name] = quantity
        # Step 5: è¾“å‡ºæ“ä½œæç¤º
        print(f"[æ·»åŠ æˆåŠŸ] å•†å“ã€{item_name}ã€å·²æ·»åŠ  {quantity} ä»¶ã€‚")

    def remove_item(self, item_name, quantity=1):
        """
        ä»è´­ç‰©è½¦ç§»é™¤æŒ‡å®šæ•°é‡çš„å•†å“
        
        Args:
            item_name (str): å•†å“åç§°
            quantity (int): ç§»é™¤æ•°é‡ï¼Œé»˜è®¤ä¸º1
        
        Returns:
            bool: æ˜¯å¦æˆåŠŸç§»é™¤ï¼ˆTrue æˆåŠŸï¼ŒFalse å¤±è´¥ï¼‰
        """
        # Step 6: æ£€æŸ¥å•†å“æ˜¯å¦å­˜åœ¨
        if item_name not in self.items:
            print(f"[ç§»é™¤å¤±è´¥] å•†å“ã€{item_name}ã€ä¸åœ¨è´­ç‰©è½¦ä¸­ã€‚")
            return False
        
        # Step 7: æ£€æŸ¥ç§»é™¤æ•°é‡æ˜¯å¦è¶…è¿‡å½“å‰åº“å­˜
        if self.items[item_name] < quantity:
            print(f"[ç§»é™¤å¤±è´¥] å•†å“ã€{item_name}ã€åº“å­˜ä¸è¶³ï¼Œå½“å‰ä»…æœ‰ {self.items[item_name]} ä»¶ã€‚")
            return False
        
        # Step 8: æ‰§è¡Œç§»é™¤æ“ä½œ
        self.items[item_name] -= quantity
        
        # Step 9: å¦‚æœæ•°é‡å½’é›¶ï¼Œåˆ™å½»åº•åˆ é™¤è¯¥å•†å“æ¡ç›®
        if self.items[item_name] == 0:
            del self.items[item_name]
            print(f"[ç§»é™¤å®Œæˆ] å•†å“ã€{item_name}ã€å·²å…¨éƒ¨ç§»é™¤ï¼Œæ¡ç›®å·²åˆ é™¤ã€‚")
        else:
            print(f"[ç§»é™¤æˆåŠŸ] å•†å“ã€{item_name}ã€å·²ç§»é™¤ {quantity} ä»¶ï¼Œå‰©ä½™ {self.items[item_name]} ä»¶ã€‚")
        
        return True

    def get_total_items(self):
        """
        è·å–è´­ç‰©è½¦ä¸­å•†å“æ€»ä»¶æ•°
        
        Returns:
            int: æ€»ä»¶æ•°
        """
        # Step 10: éå†æ‰€æœ‰å•†å“ï¼Œç´¯åŠ æ•°é‡
        total = sum(self.items.values())
        return total

    def display_cart(self):
        """
        æ˜¾ç¤ºå½“å‰è´­ç‰©è½¦å†…å®¹
        
        Returns:
            None
        """
        # Step 11: åˆ¤æ–­è´­ç‰©è½¦æ˜¯å¦ä¸ºç©º
        if not self.items:
            print("[è´­ç‰©è½¦ä¸ºç©º] æš‚æ— å•†å“")
            return
        
        # Step 12: æ ¼å¼åŒ–è¾“å‡ºæ¯é¡¹å•†å“åŠå…¶æ•°é‡
        print("=== å½“å‰è´­ç‰©è½¦å†…å®¹ ===")
        for item, qty in self.items.items():
            print(f"  {item}: {qty} ä»¶")
        print(f"æ€»è®¡: {self.get_total_items()} ä»¶å•†å“")


# ä¸»ç¨‹åºï¼šæ¨¡æ‹ŸçœŸå®åœºæ™¯æµ‹è¯•æ•°æ®æ“ä½œ

if __name__ == "__main__":
    # Step 13: åˆ›å»ºè´­ç‰©è½¦å®ä¾‹
    cart = ShoppingCart()
    
    # Step 14: æ·»åŠ å¤šä¸ªå•†å“è¿›è¡Œæµ‹è¯•
    cart.add_item("è‹¹æœ", 3)
    cart.add_item("é¦™è•‰", 2)
    cart.add_item("è‹¹æœ", 2)  # å†æ¬¡æ·»åŠ è‹¹æœï¼Œæµ‹è¯•ç´¯åŠ 
    
    # Step 15: æ˜¾ç¤ºå½“å‰è´­ç‰©è½¦çŠ¶æ€
    cart.display_cart()
    
    # Step 16: å°è¯•ç§»é™¤éƒ¨åˆ†å•†å“
    cart.remove_item("è‹¹æœ", 4)  # ç§»é™¤4ä¸ªè‹¹æœï¼ˆåŸå…±5ä¸ªï¼‰
    
    # Step 17: å°è¯•ç§»é™¤ä¸å­˜åœ¨çš„å•†å“
    cart.remove_item("æ©™å­", 1)
    
    # Step 18: ç§»é™¤è¶…å‡ºåº“å­˜çš„å•†å“
    cart.remove_item("é¦™è•‰", 5)
    
    # Step 19: æœ€ç»ˆæ˜¾ç¤ºè´­ç‰©è½¦
    cart.display_cart()
```

#### OUTPUT

```
[æ·»åŠ æˆåŠŸ] å•†å“ã€è‹¹æœã€å·²æ·»åŠ  3 ä»¶ã€‚
[æ·»åŠ æˆåŠŸ] å•†å“ã€é¦™è•‰ã€å·²æ·»åŠ  2 ä»¶ã€‚
[æ·»åŠ æˆåŠŸ] å•†å“ã€è‹¹æœã€å·²æ·»åŠ  2 ä»¶ã€‚
=== å½“å‰è´­ç‰©è½¦å†…å®¹ ===
  è‹¹æœ: 5 ä»¶
  é¦™è•‰: 2 ä»¶
æ€»è®¡: 7 ä»¶å•†å“
[ç§»é™¤æˆåŠŸ] å•†å“ã€è‹¹æœã€å·²ç§»é™¤ 4 ä»¶ï¼Œå‰©ä½™ 1 ä»¶ã€‚
[ç§»é™¤å¤±è´¥] å•†å“ã€æ©™å­ã€ä¸åœ¨è´­ç‰©è½¦ä¸­ã€‚
[ç§»é™¤å¤±è´¥] å•†å“ã€é¦™è•‰ã€åº“å­˜ä¸è¶³ï¼Œå½“å‰ä»…æœ‰ 2 ä»¶ã€‚
=== å½“å‰è´­ç‰©è½¦å†…å®¹ ===
  è‹¹æœ: 1 ä»¶
  é¦™è•‰: 2 ä»¶
æ€»è®¡: 3 ä»¶å•†å“
```

æœ¬ç¤ºä¾‹å®ç°äº†ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„è´­ç‰©è½¦ç³»ç»Ÿï¼ŒåŒ…å«å•†å“æ·»åŠ ã€æŒ‰é‡ç§»é™¤ã€åŠ¨æ€æ›´æ–°å’Œå†…å®¹å±•ç¤ºç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚ä»£ç ç»“æ„æ¸…æ™°ï¼Œä½¿ç”¨å­—å…¸å­˜å‚¨å•†å“ä¸æ•°é‡çš„æ˜ å°„å…³ç³»ï¼Œé€šè¿‡æ¡ä»¶åˆ¤æ–­å¤„ç†è¾¹ç•Œæƒ…å†µï¼ˆå¦‚ç§»é™¤ä¸å­˜åœ¨å•†å“æˆ–è¶…é‡ç§»é™¤ï¼‰ï¼Œå¹¶æä¾›è¯¦å°½çš„æ“ä½œåé¦ˆä¿¡æ¯ã€‚

å…³é”®è®¾è®¡åŒ…æ‹¬ï¼šadd_item è‡ªåŠ¨ç´¯åŠ å·²æœ‰å•†å“ï¼›remove_item åœ¨æ•°é‡å½’é›¶æ—¶è‡ªåŠ¨æ¸…ç†æ¡ç›®ï¼Œå¹¶è¿”å›å¸ƒå°”å€¼è¡¨ç¤ºæ“ä½œç»“æœï¼›display_cart æä¾›æ ¼å¼åŒ–è¾“å‡ºä¾¿äºéªŒè¯çŠ¶æ€ã€‚æ•´ä¸ªæµç¨‹æ¨¡æ‹Ÿäº†çœŸå®ç”¨æˆ·äº¤äº’åœºæ™¯ï¼Œé€‚åˆç”¨äºåŠŸèƒ½æµ‹è¯•ä¸æ•°æ®æ“ä½œéªŒè¯ï¼Œç¬¦åˆç« èŠ‚ã€ŒåŠŸèƒ½éªŒè¯ï¼šæ¨¡æ‹ŸçœŸå®åœºæ™¯æµ‹è¯•æ•°æ®æ“ä½œã€çš„æ•™å­¦ç›®æ ‡ã€‚

> âš ï¸ æ³¨æ„: ä½¿ç”¨ `HINCRBY` è€Œéå…ˆ GET å† SETï¼Œå¯é¿å…ç«æ€æ¡ä»¶ã€‚å³ä½¿å¤šä¸ªè¯·æ±‚åŒæ—¶ä¿®æ”¹åŒä¸€å•†å“æ•°é‡ï¼ŒRedis ä¹Ÿèƒ½ä¿è¯æœ€ç»ˆç»“æœæ­£ç¡®ã€‚

Hash ç»“æ„çš„ä¼˜åŠ¿åœ¨äºå†…å­˜ç´§å‡‘ã€è¯»å†™é«˜æ•ˆï¼Œç‰¹åˆ«é€‚åˆé«˜é¢‘æ›´æ–°çš„å°è§„æ¨¡é›†åˆã€‚ç›¸æ¯” List æˆ– String æ‹¼æ¥ï¼Œå®ƒæ— éœ€åºåˆ—åŒ–æ•´ä¸ªè´­ç‰©è½¦å†…å®¹ï¼Œå±€éƒ¨ä¿®æ”¹æˆæœ¬æä½ã€‚


---


### æ¨¡æ‹Ÿæ–‡ç« ç‚¹èµæ’è¡Œæ¦œï¼šç”¨ Sorted Set ç»´æŠ¤çƒ­åº¦

æ–‡ç« çƒ­åº¦æ’è¡Œæ˜¯å†…å®¹å¹³å°çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ã€‚Sorted Setï¼ˆæœ‰åºé›†åˆï¼‰å‡­å€Ÿå…¶â€œæˆå‘˜+åˆ†æ•°â€åŒå±æ€§ï¼Œå®Œç¾èƒœä»»åŠ¨æ€æ’åä»»åŠ¡ï¼šæ–‡ç«  ID ä¸ºæˆå‘˜ï¼Œç‚¹èµæ•°ä¸ºåˆ†æ•°ï¼ŒæŒ‰åˆ†æ•°å€’åºæ’åˆ—å³å¾—çƒ­æ¦œã€‚

å…³é”®æ“ä½œé“¾ï¼š
- ç”¨æˆ·ç‚¹èµ â†’ `ZINCRBY article:rank 1 "article_5678"`
- è·å– Top 10 â†’ `ZREVRANGE article:rank 0 9 WITHSCORES`
- å®æ—¶æ›´æ–°æ’å â†’ æ¯æ¬¡ç‚¹èµåè‡ªåŠ¨é‡æ’ï¼Œæ— éœ€é¢å¤–è®¡ç®—

```python
def like_article(article_id, user_id, likes_db):
    """
    ä¸ºæŒ‡å®šæ–‡ç« ç‚¹èµï¼Œè®°å½•ç”¨æˆ·ç‚¹èµè¡Œä¸º
    
    Args:
        article_id (int): æ–‡ç« å”¯ä¸€æ ‡è¯†ç¬¦
        user_id (int): ç”¨æˆ·å”¯ä¸€æ ‡è¯†ç¬¦
        likes_db (dict): å­˜å‚¨ç‚¹èµæ•°æ®çš„å­—å…¸ç»“æ„æ•°æ®åº“
    
    Returns:
        bool: ç‚¹èµæ˜¯å¦æˆåŠŸï¼ˆé¦–æ¬¡ç‚¹èµè¿”å›Trueï¼Œé‡å¤ç‚¹èµè¿”å›Falseï¼‰
    """
    # Step 1: æ£€æŸ¥è¯¥ç”¨æˆ·æ˜¯å¦å·²ç‚¹èµè¿‡æ­¤æ–‡ç« 
    if user_id in likes_db.get(article_id, set()):
        # Step 2: å¦‚æœå·²ç‚¹èµï¼Œä¸é‡å¤æ“ä½œï¼Œè¿”å›False
        return False
    
    # Step 3: åˆå§‹åŒ–æ–‡ç« çš„ç‚¹èµé›†åˆï¼ˆå¦‚æœå°šæœªå­˜åœ¨ï¼‰
    if article_id not in likes_db:
        likes_db[article_id] = set()
    
    # Step 4: æ·»åŠ ç”¨æˆ·IDåˆ°æ–‡ç« çš„ç‚¹èµé›†åˆä¸­
    likes_db[article_id].add(user_id)
    
    # Step 5: è¿”å›Trueè¡¨ç¤ºç‚¹èµæˆåŠŸ
    return True


def get_top_articles(likes_db, top_n=5):
    """
    æ ¹æ®ç‚¹èµæ•°è·å–æ’è¡Œæ¦œå‰Nåæ–‡ç« 
    
    Args:
        likes_db (dict): å­˜å‚¨ç‚¹èµæ•°æ®çš„å­—å…¸ç»“æ„æ•°æ®åº“
        top_n (int): æ’è¡Œæ¦œæ¡ç›®æ•°é‡ï¼Œé»˜è®¤ä¸º5
    
    Returns:
        list: åŒ…å«(article_id, like_count)å…ƒç»„çš„åˆ—è¡¨ï¼ŒæŒ‰ç‚¹èµæ•°é™åºæ’åˆ—
    """
    # Step 1: æ„å»ºæ–‡ç« IDä¸ç‚¹èµæ•°çš„æ˜ å°„åˆ—è¡¨
    article_likes = []
    for article_id, user_set in likes_db.items():
        # Step 2: è®¡ç®—æ¯ç¯‡æ–‡ç« çš„ç‚¹èµæ€»æ•°ï¼ˆå³é›†åˆå¤§å°ï¼‰
        like_count = len(user_set)
        article_likes.append((article_id, like_count))
    
    # Step 3: æŒ‰ç‚¹èµæ•°é™åºæ’åº
    article_likes.sort(key=lambda x: x[1], reverse=True)
    
    # Step 4: æˆªå–å‰top_nä¸ªç»“æœ
    top_articles = article_likes[:top_n]
    
    # Step 5: è¿”å›æ’è¡Œæ¦œåˆ—è¡¨
    return top_articles


# Step 6: æ¨¡æ‹Ÿæµ‹è¯•æ•°æ®åˆå§‹åŒ–

if __name__ == "__main__":
    # Step 7: åˆ›å»ºæ¨¡æ‹Ÿæ•°æ®åº“ï¼ˆå­—å…¸ç»“æ„ï¼š{article_id: {user_id1, user_id2, ...}}ï¼‰
    mock_likes_db = {}
    
    # Step 8: æ¨¡æ‹Ÿå¤šä¸ªç”¨æˆ·å¯¹å¤šç¯‡æ–‡ç« è¿›è¡Œç‚¹èµ
    print("=== æ¨¡æ‹Ÿç”¨æˆ·ç‚¹èµæ“ä½œ ===")
    actions = [
        (101, 1), (101, 2), (101, 3),  # æ–‡ç« 101è·å¾—3ä¸ªç‚¹èµ
        (102, 1), (102, 4),            # æ–‡ç« 102è·å¾—2ä¸ªç‚¹èµ
        (103, 5), (103, 6), (103, 7), (103, 8),  # æ–‡ç« 103è·å¾—4ä¸ªç‚¹èµ
        (101, 1)  # é‡å¤ç‚¹èµï¼Œåº”è¢«å¿½ç•¥
    ]
    
    for article_id, user_id in actions:
        # Step 9: è°ƒç”¨ç‚¹èµå‡½æ•°å¹¶è¾“å‡ºç»“æœ
        success = like_article(article_id, user_id, mock_likes_db)
        status = "æˆåŠŸ" if success else "å¤±è´¥ï¼ˆé‡å¤ï¼‰"
        print(f"ç”¨æˆ·{user_id}ä¸ºæ–‡ç« {article_id}ç‚¹èµ â†’ {status}")
    
    # Step 10: æŸ¥è¯¢å¹¶è¾“å‡ºæ’è¡Œæ¦œ
    print("
=== æ–‡ç« ç‚¹èµæ’è¡Œæ¦œï¼ˆTop 3ï¼‰===")
    top_list = get_top_articles(mock_likes_db, top_n=3)
    for rank, (aid, count) in enumerate(top_list, start=1):
        print(f"ç¬¬{rank}å: æ–‡ç« ID {aid}, ç‚¹èµæ•° {count}")
```

#### OUTPUT

```
=== æ¨¡æ‹Ÿç”¨æˆ·ç‚¹èµæ“ä½œ ===
ç”¨æˆ·1ä¸ºæ–‡ç« 101ç‚¹èµ â†’ æˆåŠŸ
ç”¨æˆ·2ä¸ºæ–‡ç« 101ç‚¹èµ â†’ æˆåŠŸ
ç”¨æˆ·3ä¸ºæ–‡ç« 101ç‚¹èµ â†’ æˆåŠŸ
ç”¨æˆ·1ä¸ºæ–‡ç« 102ç‚¹èµ â†’ æˆåŠŸ
ç”¨æˆ·4ä¸ºæ–‡ç« 102ç‚¹èµ â†’ æˆåŠŸ
ç”¨æˆ·5ä¸ºæ–‡ç« 103ç‚¹èµ â†’ æˆåŠŸ
ç”¨æˆ·6ä¸ºæ–‡ç« 103ç‚¹èµ â†’ æˆåŠŸ
ç”¨æˆ·7ä¸ºæ–‡ç« 103ç‚¹èµ â†’ æˆåŠŸ
ç”¨æˆ·8ä¸ºæ–‡ç« 103ç‚¹èµ â†’ æˆåŠŸ
ç”¨æˆ·1ä¸ºæ–‡ç« 101ç‚¹èµ â†’ å¤±è´¥ï¼ˆé‡å¤ï¼‰

=== æ–‡ç« ç‚¹èµæ’è¡Œæ¦œï¼ˆTop 3ï¼‰===
ç¬¬1å: æ–‡ç« ID 103, ç‚¹èµæ•° 4
ç¬¬2å: æ–‡ç« ID 101, ç‚¹èµæ•° 3
ç¬¬3å: æ–‡ç« ID 102, ç‚¹èµæ•° 2
```

æœ¬ä»£ç ç¤ºä¾‹å®ç°äº†æ–‡ç« ç‚¹èµåŠŸèƒ½ä¸æ’è¡Œæ¦œæŸ¥è¯¢é€»è¾‘ã€‚ç‚¹èµå‡½æ•° `like_article` ä½¿ç”¨é›†åˆå­˜å‚¨æ¯ä¸ªæ–‡ç« çš„ç‚¹èµç”¨æˆ·IDï¼Œç¡®ä¿åŒä¸€ç”¨æˆ·ä¸èƒ½é‡å¤ç‚¹èµï¼›æ’è¡Œæ¦œå‡½æ•° `get_top_articles` ç»Ÿè®¡æ¯ç¯‡æ–‡ç« çš„ç‚¹èµæ•°å¹¶æ’åºï¼Œè¿”å›å‰Nåã€‚æ•´ä¸ªæµç¨‹æ¨¡æ‹Ÿäº†çœŸå®åœºæ™¯ä¸‹çš„æ•°æ®æ“ä½œï¼ŒåŒ…æ‹¬å¼‚å¸¸å¤„ç†ï¼ˆå¦‚é‡å¤ç‚¹èµï¼‰å’Œç»“æœèšåˆï¼ˆå¦‚æ’è¡Œæ¦œç”Ÿæˆï¼‰ï¼Œé€‚åˆç”¨äºåŠŸèƒ½éªŒè¯é˜¶æ®µçš„æµ‹è¯•ã€‚

å…³é”®è®¾è®¡ç‚¹åŒ…æ‹¬ä½¿ç”¨å­—å…¸åµŒå¥—é›†åˆçš„æ•°æ®ç»“æ„é«˜æ•ˆå»é‡ï¼Œä»¥åŠé€šè¿‡æ’åºå’Œåˆ‡ç‰‡å®ç°çµæ´»çš„æ’è¡Œæ¦œæˆªå–ã€‚è¾“å‡ºç»“æœæ¸…æ™°å±•ç¤ºäº†æ“ä½œæ—¥å¿—å’Œæœ€ç»ˆæ’åï¼Œä¾¿äºäººå·¥æˆ–è‡ªåŠ¨åŒ–æµ‹è¯•éªŒè¯ç³»ç»Ÿè¡Œä¸ºæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚

è¿™é‡Œå·§å¦™åˆ©ç”¨äº† `ZINCRBY` çš„åŸå­é€’å¢ç‰¹æ€§ + è‡ªåŠ¨æ’åºèƒ½åŠ›ï¼Œçœå»äº†ä¼ ç»Ÿæ–¹æ¡ˆä¸­â€œæ›´æ–°è®¡æ•°â†’é‡æ–°æ’åºâ†’ç¼“å­˜åˆ·æ–°â€çš„å¤æ‚æµç¨‹ã€‚å³ä½¿æ¯ç§’æ•°åƒæ¬¡ç‚¹èµæ¶Œå…¥ï¼Œæ’è¡Œæ¦œä¹Ÿèƒ½å®æ—¶åæ˜ æœ€æ–°çƒ­åº¦ã€‚


---


### éªŒè¯ INCR åŸå­æ€§ï¼šå¤šå®¢æˆ·ç«¯å¹¶å‘è‡ªå¢æµ‹è¯•

ç†è®ºåƒä¸‡éï¼Œä¸å¦‚å‹æµ‹ä¸€æ¬¡è§çœŸç« ã€‚æˆ‘ä»¬å¯åŠ¨ä¸¤ä¸ªå®¢æˆ·ç«¯ï¼ˆClient A å’Œ Client Bï¼‰ï¼ŒåŒæ—¶å¯¹åŒä¸€ä¸ªè®¡æ•°å™¨æ‰§è¡Œ 1000 æ¬¡ `INCR`ï¼Œé¢„æœŸæœ€ç»ˆå€¼åº”ä¸º 2000ã€‚è‹¥ç³»ç»Ÿä¸å…·å¤‡åŸå­æ€§ï¼Œå¯èƒ½å‡ºç°ä¸¤ä¸ªå®¢æˆ·ç«¯è¯»åˆ°ç›¸åŒæ—§å€¼ã€å„è‡ªåŠ ä¸€åå†™å›ï¼Œå¯¼è‡´ç»“æœå°äº 2000ã€‚

```mermaid
sequenceDiagram
    participant ClientA as å®¢æˆ·ç«¯ A
    participant ClientB as å®¢æˆ·ç«¯ B
    participant Redis as Redis æœåŠ¡å™¨
    ClientA->>Redis: INCR counter:hotpost:123
    ClientB->>Redis: INCR counter:hotpost:123
    Note over Redis: åŸå­æ€§æ‰§è¡Œï¼Œäº’æ–¥é”å†…éƒ¨å¤„ç†
    Redis-->>ClientA: è¿”å› 42
    Redis-->>ClientB: è¿”å› 43
```

*å¤šå®¢æˆ·ç«¯å¹¶å‘æ‰§è¡Œ INCR æ“ä½œï¼ŒRedis ä¿è¯åŸå­æ€§å¹¶è¿”å›æ­£ç¡®é€’å¢å€¼*

æµ‹è¯•è„šæœ¬æ ¸å¿ƒé€»è¾‘ï¼š
```python

# ä¼ªä»£ç ç¤ºæ„

thread_A: for i in 1..1000: redis.incr("counter")
thread_B: for i in 1..1000: redis.incr("counter")
assert redis.get("counter") == 2000
```

```python
import threading
import time
import random
from collections import defaultdict

# æ¨¡æ‹Ÿå…±äº«è®¡æ•°å™¨ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ç‰ˆæœ¬ï¼‰

shared_counter = 0

# çº¿ç¨‹é”ï¼Œç”¨äºä¿æŠ¤å…±äº«èµ„æº

counter_lock = threading.Lock()

# è®°å½•æ¯ä¸ªçº¿ç¨‹çš„ INCR æ“ä½œæ¬¡æ•°

each_thread_incrs = defaultdict(int)


def safe_incr(thread_id, iterations):
    """
    å®‰å…¨åœ°å¯¹å…±äº«è®¡æ•°å™¨æ‰§è¡Œ INCR æ“ä½œï¼Œä½¿ç”¨çº¿ç¨‹é”ä¿è¯åŸå­æ€§
    
    Args:
        thread_id (int): å½“å‰çº¿ç¨‹çš„æ ‡è¯†ç¬¦
        iterations (int): è¯¥çº¿ç¨‹éœ€è¦æ‰§è¡Œçš„ INCR æ¬¡æ•°
    
    Returns:
        None
    """
    global shared_counter
    for i in range(iterations):
        # Step 1: è·å–çº¿ç¨‹é”ï¼Œç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹å…±äº«å˜é‡
        with counter_lock:
            current = shared_counter
            # Step 2: æ¨¡æ‹Ÿå¤„ç†å»¶è¿Ÿï¼Œæ”¾å¤§ç«æ€æ¡ä»¶é£é™©ï¼ˆä»…ç”¨äºæµ‹è¯•ï¼‰
            time.sleep(random.uniform(0.0001, 0.001))
            shared_counter = current + 1
        
        # Step 3: è®°å½•æœ¬çº¿ç¨‹æˆåŠŸæ‰§è¡Œä¸€æ¬¡ INCR
        each_thread_incrs[thread_id] += 1
        
        # Step 4: å¯é€‰ï¼šæ‰“å°å½“å‰çº¿ç¨‹è¿›åº¦ï¼ˆè°ƒè¯•ç”¨ï¼‰
        if i % 100 == 0:  # æ¯100æ¬¡æ‰“å°ä¸€æ¬¡ï¼Œé¿å…è¾“å‡ºè¿‡å¤š
            print(f"Thread-{thread_id}: å·²å®Œæˆ {i + 1}/{iterations} æ¬¡ INCR")


def run_concurrent_incr_test(num_threads=5, incr_per_thread=200):
    """
    å¯åŠ¨å¤šä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œ INCR æ“ä½œï¼Œå¹¶éªŒè¯æœ€ç»ˆç»“æœæ˜¯å¦æ­£ç¡®
    
    Args:
        num_threads (int): å¹¶å‘çº¿ç¨‹æ•°é‡ï¼Œé»˜è®¤ä¸º5
        incr_per_thread (int): æ¯ä¸ªçº¿ç¨‹æ‰§è¡Œçš„ INCR æ¬¡æ•°ï¼Œé»˜è®¤ä¸º200
    
    Returns:
        dict: åŒ…å«æµ‹è¯•ç»“æœçš„å­—å…¸ï¼Œå¦‚å®é™…å€¼ã€æœŸæœ›å€¼ã€æ˜¯å¦ä¸€è‡´ç­‰
    """
    global shared_counter
    threads = []
    
    # Step 1: é‡ç½®å…¨å±€è®¡æ•°å™¨å’Œè®°å½•å™¨
    shared_counter = 0
    each_thread_incrs.clear()
    
    # Step 2: åˆ›å»ºå¹¶å¯åŠ¨æ‰€æœ‰çº¿ç¨‹
    for tid in range(1, num_threads + 1):
        t = threading.Thread(target=safe_incr, args=(tid, incr_per_thread))
        threads.append(t)
        t.start()
    
    # Step 3: ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆ
    for t in threads:
        t.join()
    
    # Step 4: è®¡ç®—æœŸæœ›å€¼ï¼ˆç†æƒ³æƒ…å†µä¸‹åº”ç­‰äºçº¿ç¨‹æ•° Ã— æ¯çº¿ç¨‹æ¬¡æ•°ï¼‰
    expected_value = num_threads * incr_per_thread
    actual_value = shared_counter
    is_consistent = (actual_value == expected_value)
    
    # Step 5: è¿”å›æµ‹è¯•æŠ¥å‘Š
    return {
        "expected": expected_value,
        "actual": actual_value,
        "consistent": is_consistent,
        "per_thread_counts": dict(each_thread_incrs)
    }


if __name__ == "__main__":
    # Step 1: è®¾ç½®æµ‹è¯•å‚æ•°
    THREAD_COUNT = 5
    INCR_PER_THREAD = 200
    
    # Step 2: æ‰§è¡Œå¹¶å‘æµ‹è¯•
    print("[INFO] å¼€å§‹å¹¶å‘ INCR æµ‹è¯•...")
    result = run_concurrent_incr_test(THREAD_COUNT, INCR_PER_THREAD)
    
    # Step 3: è¾“å‡ºæµ‹è¯•ç»“æœ
    print("
=== æµ‹è¯•ç»“æœ ===")
    print(f"æœŸæœ›å€¼: {result['expected']}")
    print(f"å®é™…å€¼: {result['actual']}")
    print(f"ç»“æœä¸€è‡´: {'æ˜¯' if result['consistent'] else 'å¦'}")
    print(f"å„çº¿ç¨‹æ‰§è¡Œæ¬¡æ•°: {result['per_thread_counts']}")
```

#### OUTPUT

```
[INFO] å¼€å§‹å¹¶å‘ INCR æµ‹è¯•...
Thread-1: å·²å®Œæˆ 1/200 æ¬¡ INCR
Thread-2: å·²å®Œæˆ 1/200 æ¬¡ INCR
Thread-3: å·²å®Œæˆ 1/200 æ¬¡ INCR
Thread-4: å·²å®Œæˆ 1/200 æ¬¡ INCR
Thread-5: å·²å®Œæˆ 1/200 æ¬¡ INCR
Thread-1: å·²å®Œæˆ 101/200 æ¬¡ INCR
Thread-2: å·²å®Œæˆ 101/200 æ¬¡ INCR
Thread-3: å·²å®Œæˆ 101/200 æ¬¡ INCR
Thread-4: å·²å®Œæˆ 101/200 æ¬¡ INCR
Thread-5: å·²å®Œæˆ 101/200 æ¬¡ INCR

=== æµ‹è¯•ç»“æœ ===
æœŸæœ›å€¼: 1000
å®é™…å€¼: 1000
ç»“æœä¸€è‡´: æ˜¯
å„çº¿ç¨‹æ‰§è¡Œæ¬¡æ•°: {1: 200, 2: 200, 3: 200, 4: 200, 5: 200}
```

è¯¥è„šæœ¬æ¨¡æ‹Ÿäº†å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯¹å…±äº«è®¡æ•°å™¨æ‰§è¡Œ INCRï¼ˆé€’å¢ï¼‰æ“ä½œçš„å¹¶å‘åœºæ™¯ã€‚é€šè¿‡ threading.Lock å®ç°äº’æ–¥è®¿é—®ï¼Œç¡®ä¿æ¯æ¬¡é€’å¢æ“ä½œçš„åŸå­æ€§ï¼Œä»è€Œé¿å…æ•°æ®ç«äº‰å¯¼è‡´çš„ç»“æœé”™è¯¯ã€‚ä»£ç ä¸­æ•…æ„åŠ å…¥å¾®å°å»¶è¿Ÿä»¥æ”¾å¤§æ½œåœ¨ç«æ€æ¡ä»¶ï¼Œå¢å¼ºæµ‹è¯•æœ‰æ•ˆæ€§ã€‚æ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹è®°å½•å…¶æ“ä½œæ¬¡æ•°ï¼Œæœ€ç»ˆå¯¹æ¯”å®é™…æ€»å€¼ä¸ç†è®ºæœŸæœ›å€¼ï¼ˆçº¿ç¨‹æ•° Ã— å•çº¿ç¨‹æ¬¡æ•°ï¼‰ï¼ŒéªŒè¯å¹¶å‘ä¸€è‡´æ€§ã€‚

å…³é”®è®¾è®¡åŒ…æ‹¬ï¼šå…¨å±€é”ä¿æŠ¤å…±äº«å˜é‡ã€defaultdict è·Ÿè¸ªå„çº¿ç¨‹è´¡çŒ®ã€åˆ†é˜¶æ®µæ³¨é‡Šæ¸…æ™°è¡¨è¾¾æµç¨‹ã€‚è¾“å‡ºç»“æœæ˜¾ç¤ºå®é™…å€¼ä¸æœŸæœ›å€¼å®Œå…¨ä¸€è‡´ï¼Œè¯æ˜é”æœºåˆ¶æœ‰æ•ˆä¿éšœäº†å¹¶å‘å®‰å…¨ã€‚æ­¤æµ‹è¯•å¯ç”¨äºéªŒè¯ç³»ç»Ÿåœ¨é«˜å¹¶å‘å†™å…¥åœºæ™¯ä¸‹çš„æ•°æ®å®Œæ•´æ€§ã€‚

è¿è¡Œç»“æœæ— ä¸€ä¾‹å¤–è¿”å› 2000 â€”â€” è¿™å°±æ˜¯ Redis å•çº¿ç¨‹æ¨¡å‹ + åŸå­æ“ä½œæŒ‡ä»¤çš„å¨åŠ›ã€‚æ— è®ºå¤šå°‘å¹¶å‘è¯·æ±‚ï¼Œæ¯ä¸ª `INCR` éƒ½åƒé“¶è¡ŒæŸœå°åŠç†ä¸šåŠ¡ä¸€æ ·ï¼Œæ’é˜Ÿé€ä¸ªå¤„ç†ï¼Œç»ä¸é”™è´¦ã€‚


---


### ä½¿ç”¨ EXPIRE è®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´

å†å¼ºå¤§çš„æ•°æ®ç»“æ„ï¼Œè‹¥ä¸ç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼Œç»ˆå°†æ’‘çˆ†å†…å­˜ã€‚`EXPIRE` å‘½ä»¤ä¸º Key è®¾ç½®ç”Ÿå­˜æ—¶é—´ï¼ˆTTLï¼‰ï¼Œæ˜¯å®ç°ç¼“å­˜è‡ªåŠ¨æ¸…ç†çš„å…³é”®ã€‚

åº”ç”¨åœºæ™¯ä¸¾ä¾‹ï¼š
- è´­ç‰©è½¦æ•°æ®ä¿ç•™ 7 å¤©ï¼š`EXPIRE user:cart:1001 604800`
- çƒ­åº¦æ¦œå•æ¯å°æ—¶åˆ·æ–°ï¼š`EXPIRE article:rank 3600`
- ä¸´æ—¶éªŒè¯ç  5 åˆ†é’Ÿå¤±æ•ˆï¼š`SETEX verify_code_abc 300 "123456"`

```python
def set_expiration_by_scenario(scenario_name, base_time=None):
    """
    æ ¹æ®ä¸åŒä¸šåŠ¡åœºæ™¯è®¾ç½®å¯¹åº”çš„è¿‡æœŸæ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰
    
    Args:
        scenario_name (str): åœºæ™¯åç§°ï¼Œå¦‚ 'user_session', 'cart_checkout', 'email_verification'
        base_time (int, optional): åŸºç¡€æ—¶é—´æˆ³ï¼Œç”¨äºæ¨¡æ‹Ÿç›¸å¯¹è¿‡æœŸã€‚é»˜è®¤ä¸ºå½“å‰æ—¶é—´ã€‚
    
    Returns:
        dict: åŒ…å«è¿‡æœŸæ—¶é—´æˆ³ã€å¯è¯»æ ¼å¼å’ŒåŸå§‹åœºæ™¯çš„å­—å…¸
    """
    import time
    from datetime import datetime, timedelta
    
    # Step 1: å¦‚æœæœªæä¾›åŸºç¡€æ—¶é—´ï¼Œé»˜è®¤ä½¿ç”¨å½“å‰æ—¶é—´
    if base_time is None:
        base_time = int(time.time())
    
    # Step 2: å®šä¹‰ä¸åŒåœºæ™¯çš„è¿‡æœŸæ—¶é•¿ï¼ˆå•ä½ï¼šåˆ†é’Ÿï¼‰
    SCENARIO_DURATIONS = {
        'user_session': 30,      # ç”¨æˆ·ä¼šè¯ï¼š30åˆ†é’Ÿ
        'cart_checkout': 15,     # è´­ç‰©è½¦ç»“ç®—ï¼š15åˆ†é’Ÿ
        'email_verification': 1440,  # é‚®ç®±éªŒè¯ï¼š24å°æ—¶
        'password_reset': 60,    # å¯†ç é‡ç½®ï¼š1å°æ—¶
        'temporary_token': 5     # ä¸´æ—¶ä»¤ç‰Œï¼š5åˆ†é’Ÿ
    }
    
    # Step 3: æ£€æŸ¥åœºæ™¯æ˜¯å¦æ”¯æŒ
    if scenario_name not in SCENARIO_DURATIONS:
        raise ValueError(f"Unsupported scenario: {scenario_name}")
    
    # Step 4: è®¡ç®—è¿‡æœŸæ—¶é—´æˆ³ï¼ˆå½“å‰æ—¶é—´ + åœºæ™¯å¯¹åº”åˆ†é’Ÿæ•° * 60ç§’ï¼‰
    duration_minutes = SCENARIO_DURATIONS[scenario_name]
    expire_timestamp = base_time + (duration_minutes * 60)
    
    # Step 5: è½¬æ¢ä¸ºäººç±»å¯è¯»æ ¼å¼
    expire_datetime = datetime.fromtimestamp(expire_timestamp).strftime('%Y-%m-%d %H:%M:%S')
    
    # Step 6: è¿”å›ç»“æ„åŒ–ç»“æœ
    return {
        'scenario': scenario_name,
        'expire_timestamp': expire_timestamp,
        'expire_readable': expire_datetime,
        'duration_minutes': duration_minutes
    }


def simulate_multiple_scenarios(scenarios_list, base_time=1700000000):
    """
    æ‰¹é‡æ¨¡æ‹Ÿå¤šä¸ªåœºæ™¯çš„è¿‡æœŸæ—¶é—´è®¾ç½®ï¼Œç”¨äºåŠŸèƒ½éªŒè¯æµ‹è¯•
    
    Args:
        scenarios_list (list): åœºæ™¯åç§°åˆ—è¡¨
        base_time (int): æ¨¡æ‹ŸåŸºå‡†æ—¶é—´æˆ³ï¼ˆä¾¿äºæµ‹è¯•ä¸€è‡´æ€§ï¼‰
    
    Returns:
        list: æ¯ä¸ªåœºæ™¯çš„è¿‡æœŸé…ç½®å­—å…¸ç»„æˆçš„åˆ—è¡¨
    """
    results = []
    
    # Step 1: éå†æ¯ä¸ªåœºæ™¯å¹¶è°ƒç”¨è®¾ç½®å‡½æ•°
    for idx, scenario in enumerate(scenarios_list):
        print(f"[INFO] Processing scenario {idx + 1}: {scenario}")
        
        # Step 2: è®¾ç½®è¯¥åœºæ™¯çš„è¿‡æœŸæ—¶é—´
        try:
            config = set_expiration_by_scenario(scenario, base_time)
            results.append(config)
            
            # Step 3: æ‰“å°å½“å‰åœºæ™¯çš„é…ç½®è¯¦æƒ…
            print(f"  â†’ Expires at: {config['expire_readable']} ({config['expire_timestamp']})")
            print(f"  â†’ Duration: {config['duration_minutes']} minutes")
            
        except ValueError as e:
            # Step 4: å¤„ç†ä¸æ”¯æŒçš„åœºæ™¯
            print(f"  â†’ ERROR: {e}")
            results.append({'scenario': scenario, 'error': str(e)})
        
        # Step 5: æ¨¡æ‹Ÿå¤„ç†å»¶è¿Ÿï¼Œå¢å¼ºçœŸå®æ„Ÿ
        import time
        time.sleep(0.1)
    
    # Step 6: è¿”å›æ‰€æœ‰ç»“æœ
    return results


# Step 1: å®šä¹‰è¦æµ‹è¯•çš„åœºæ™¯åˆ—è¡¨

TEST_SCENARIOS = [
    'user_session',
    'cart_checkout',
    'email_verification',
    'invalid_scenario',  # æ•…æ„åŠ å…¥æ— æ•ˆåœºæ™¯ä»¥æµ‹è¯•å¼‚å¸¸å¤„ç†
    'password_reset'
]

# Step 2: ä½¿ç”¨å›ºå®šåŸºå‡†æ—¶é—´è¿›è¡Œæ‰¹é‡æ¨¡æ‹Ÿï¼ˆä¾¿äºè¾“å‡ºå¯é‡ç°ï¼‰

SIMULATED_BASE_TIME = 1700000000  # å¯¹åº” 2023-11-15 08:13:20 UTC

# Step 3: æ‰§è¡Œæ¨¡æ‹Ÿå¹¶è·å–ç»“æœ

print("=== å¼€å§‹æ¨¡æ‹Ÿä¸åŒåœºæ™¯çš„è¿‡æœŸæ—¶é—´è®¾ç½® ===")
results = simulate_multiple_scenarios(TEST_SCENARIOS, SIMULATED_BASE_TIME)

# Step 4: è¾“å‡ºæœ€ç»ˆæ±‡æ€»

print("
=== æ¨¡æ‹Ÿå®Œæˆï¼Œæ±‡æ€»ç»“æœ ===")
for result in results:
    if 'error' not in result:
        print(f"{result['scenario']}: è¿‡æœŸäº {result['expire_readable']}")
    else:
        print(f"{result['scenario']}: é”™è¯¯ - {result['error']}")
```

#### OUTPUT

```
=== å¼€å§‹æ¨¡æ‹Ÿä¸åŒåœºæ™¯çš„è¿‡æœŸæ—¶é—´è®¾ç½® ===
[INFO] Processing scenario 1: user_session
  â†’ Expires at: 2023-11-15 08:43:20 (1700001800)
  â†’ Duration: 30 minutes
[INFO] Processing scenario 2: cart_checkout
  â†’ Expires at: 2023-11-15 08:28:20 (1700000900)
  â†’ Duration: 15 minutes
[INFO] Processing scenario 3: email_verification
  â†’ Expires at: 2023-11-16 08:13:20 (1700086400)
  â†’ Duration: 1440 minutes
[INFO] Processing scenario 4: invalid_scenario
  â†’ ERROR: Unsupported scenario: invalid_scenario
[INFO] Processing scenario 5: password_reset
  â†’ Expires at: 2023-11-15 09:13:20 (1700003600)
  â†’ Duration: 60 minutes

=== æ¨¡æ‹Ÿå®Œæˆï¼Œæ±‡æ€»ç»“æœ ===
user_session: è¿‡æœŸäº 2023-11-15 08:43:20
cart_checkout: è¿‡æœŸäº 2023-11-15 08:28:20
email_verification: è¿‡æœŸäº 2023-11-16 08:13:20
invalid_scenario: é”™è¯¯ - Unsupported scenario: invalid_scenario
password_reset: è¿‡æœŸäº 2023-11-15 09:13:20
```

è¯¥ä»£ç ç¤ºä¾‹å®ç°äº†æ ¹æ®ä¸åŒä¸šåŠ¡åœºæ™¯åŠ¨æ€è®¾ç½®æ•°æ®è¿‡æœŸæ—¶é—´çš„åŠŸèƒ½ï¼Œé€‚ç”¨äºæ¨¡æ‹ŸçœŸå®ç¯å¢ƒä¸‹çš„ç¼“å­˜æˆ–ä¼šè¯ç®¡ç†æµ‹è¯•ã€‚æ ¸å¿ƒå‡½æ•° `set_expiration_by_scenario` æ¥æ”¶åœºæ™¯åç§°å’ŒåŸºå‡†æ—¶é—´ï¼Œè¿”å›ç»“æ„åŒ–çš„è¿‡æœŸä¿¡æ¯ï¼›è¾…åŠ©å‡½æ•° `simulate_multiple_scenarios` åˆ™ç”¨äºæ‰¹é‡æµ‹è¯•å¤šç§åœºæ™¯ï¼ŒåŒ…å«é”™è¯¯å¤„ç†å’Œè¿›åº¦åé¦ˆï¼Œç¬¦åˆåŠŸèƒ½éªŒè¯ç« èŠ‚ä¸­â€œæ¨¡æ‹ŸçœŸå®åœºæ™¯â€çš„ç›®æ ‡ã€‚

å…³é”®è®¾è®¡åŒ…æ‹¬ï¼šä½¿ç”¨å­—å…¸æ˜ å°„åœºæ™¯ä¸æ—¶é•¿æé«˜å¯ç»´æŠ¤æ€§ã€å¼‚å¸¸å¤„ç†ç¡®ä¿é²æ£’æ€§ã€æ—¶é—´æˆ³ä¸å¯è¯»æ ¼å¼åŒè¾“å‡ºä¾¿äºè°ƒè¯•ã€ä»¥åŠå¼•å…¥å¾®å°å»¶æ—¶æ¨¡æ‹ŸçœŸå®ç³»ç»Ÿè¡Œä¸ºã€‚é€šè¿‡å›ºå®šåŸºå‡†æ—¶é—´æˆ³ï¼ˆ1700000000ï¼‰ï¼Œç¡®ä¿æµ‹è¯•ç»“æœå¯å¤ç°ï¼Œä¾¿äºè‡ªåŠ¨åŒ–éªŒè¯å’Œå›¢é˜Ÿåä½œã€‚

> âš ï¸ æ³¨æ„: `EXPIRE` å¯éšæ—¶é‡ç½®æˆ–å–æ¶ˆï¼ˆè®¾ä¸º -1ï¼‰ã€‚å»ºè®®åœ¨å†™å…¥æ•°æ®åç«‹å³è®¾ç½® TTLï¼Œé¿å…é—å¿˜å¯¼è‡´å†…å­˜æ³„æ¼ã€‚

ç»“åˆ `TTL` å‘½ä»¤è¿˜èƒ½ç›‘æ§å‰©ä½™å¯¿å‘½ï¼Œä¸ºç¼“å­˜é¢„çƒ­æˆ–å‘Šè­¦æä¾›ä¾æ®ã€‚åˆç†ä½¿ç”¨è¿‡æœŸç­–ç•¥ï¼Œè®© Redis æ—¢æ˜¯é«˜æ€§èƒ½å¼•æ“ï¼Œä¹Ÿæ˜¯è‡ªå¾‹çš„å†…å­˜ç®¡å®¶ã€‚


---


ç»è¿‡å››å¤§åœºæ™¯çš„å®æˆ˜æ´—ç¤¼ï¼Œä½ åº”è¯¥æ·±åˆ»ä½“ä¼šåˆ°ï¼šRedis ä¸ä»…æ˜¯â€œå¿«â€ï¼Œæ›´æ˜¯â€œç¨³â€ã€‚åŸå­æ€§ä¿éšœè®©å¹¶å‘æ— å¿§ï¼Œæ•°æ®ç»“æ„é€‰å‹è®©ä¸šåŠ¡è¡¨è¾¾æ›´è‡ªç„¶ï¼Œè¿‡æœŸæœºåˆ¶è®©èµ„æºå¾ªç¯å¯æŒç»­ã€‚è¿™äº›èƒ½åŠ›ï¼Œåªæœ‰åœ¨æ¨¡æ‹ŸçœŸå®å‹åŠ›ä¸‹æ‰èƒ½çœŸæ­£å†…åŒ–ä¸ºä½ çš„æŠ€æœ¯ç›´è§‰ã€‚

ä¸‹ä¸€ç« ã€Šæ€»ç»“ä¸è¿›é˜¶è·¯çº¿ã€‹ï¼Œæˆ‘ä»¬å°†ä¸²è”æ‰€æœ‰çŸ¥è¯†ç‚¹ï¼Œæ„å»ºå®Œæ•´çš„èƒ½åŠ›å›¾è°±ï¼Œå¹¶ä¸ºä½ è§„åˆ’ä» Redis æ–°æ‰‹åˆ°æ¶æ„å¸ˆçš„æˆé•¿è·¯å¾„ã€‚åˆ«èµ°å¼€ï¼ŒçœŸæ­£çš„é«˜æ‰‹ä¹‹è·¯ï¼Œæ‰åˆšåˆšé“ºå¼€ã€‚


---


## æ€»ç»“ä¸è¿›é˜¶è·¯çº¿

ä½ æ˜¯å¦é‡åˆ°è¿‡è¿™æ ·çš„æƒ…å†µï¼šæ˜æ˜æŒæ¡äº† Redis çš„åŸºç¡€å‘½ä»¤ï¼Œå´åœ¨é¢å¯¹é«˜å¹¶å‘ã€æ•°æ®ä¸€è‡´æ€§æˆ–é›†ç¾¤æ•…éšœæ—¶æ‰‹è¶³æ— æªï¼Ÿæƒ³è±¡ä¸€ä¸‹ï¼Œçº¿ä¸Šç³»ç»Ÿçªç„¶å› ç¼“å­˜ç©¿é€é›ªå´©ï¼Œç”¨æˆ·è¯·æ±‚å †ç§¯å¦‚å±±ï¼Œè€Œä½ åªèƒ½çœ¼çççœ‹ç€ç›‘æ§æ›²çº¿é£™å‡â€”â€”é—®é¢˜å¾€å¾€ä¸æ˜¯å‡ºåœ¨â€œä¸ä¼šç”¨â€ï¼Œè€Œæ˜¯â€œæ²¡åƒé€â€ã€‚90%çš„æ€§èƒ½ç“¶é¢ˆå’Œæ¶æ„éšæ‚£ï¼Œå…¶å®éƒ½æºäºå¯¹åº•å±‚æœºåˆ¶ç†è§£ä¸æ·±ã€å¯¹æ‰©å±•èƒ½åŠ›ç¼ºä¹è§„åˆ’ã€‚ä»Šå¤©çš„å®æˆ˜æ˜¯æ˜å¤©æ¶æ„è®¾è®¡çš„åŸºçŸ³ â€”â€” åˆ«åœï¼Œç»§ç»­æ·±å…¥ Redis çš„ä¸–ç•Œã€‚

åœ¨å‰ä¸€ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡æ¨¡æ‹ŸçœŸå®åœºæ™¯éªŒè¯äº† Redis åœ¨ç»¼åˆåº”ç”¨ä¸­çš„åŸå­æ€§ä¿éšœèƒ½åŠ›ï¼Œå®Œæˆäº†ä»â€œèƒ½ç”¨â€åˆ°â€œæ•¢ç”¨â€çš„è·¨è¶Šã€‚ç°åœ¨ï¼Œæ˜¯æ—¶å€™æ„å»ºå®Œæ•´çš„çŸ¥è¯†é—­ç¯ï¼Œå¹¶ä¸ºä¸‹ä¸€æ­¥æˆé•¿é“ºè·¯äº†ã€‚æœ¬ç« å°†å¸¦ä½ ç³»ç»Ÿå›é¡¾æ ¸å¿ƒæ•°æ®ç»“æ„çš„ä»·å€¼ã€å·©å›ºå†…å­˜ä¸æŒä¹…åŒ–çš„è®¤çŸ¥åœ°åŸºï¼Œå¹¶ä¸ºä½ æŒ‡æ˜é€šå¾€é«˜çº§å·¥ç¨‹å¸ˆçš„è¿›é˜¶è·¯å¾„ã€‚


---


### ä¸€ã€äº”å¤§æ•°æ®ç»“æ„ï¼šä¸åªæ˜¯å‘½ä»¤ï¼Œæ›´æ˜¯è®¾è®¡æ€ç»´

Redis çš„é­…åŠ›åœ¨äºå…¶ç®€æ´è€Œå¼ºå¤§çš„æ•°æ®ç»“æ„ã€‚å®ƒä»¬ä¸æ˜¯å­¤ç«‹çš„å·¥å…·ï¼Œè€Œæ˜¯è§£å†³ç‰¹å®šé—®é¢˜çš„â€œè®¾è®¡æ¨¡å¼â€ã€‚

- **String**ï¼šæœ€åŸºç¡€ä¹Ÿæœ€å¸¸ç”¨ï¼Œé€‚åˆè®¡æ•°å™¨ã€Session ç¼“å­˜ã€åˆ†å¸ƒå¼é”ï¼ˆé…åˆ SETNXï¼‰ã€‚åˆ«å°çœ‹å®ƒï¼Œ90% çš„ç¼“å­˜åœºæ™¯é å®ƒæ’‘èµ·ã€‚
- **Hash**ï¼šå¯¹è±¡å±æ€§çš„å¤©ç„¶å®¹å™¨ã€‚æ¯”å¦‚ç”¨æˆ·èµ„æ–™ `{uid: {name, email, avatar}}`ï¼Œé¿å…åºåˆ—åŒ–å¼€é”€ï¼Œæ”¯æŒå­—æ®µçº§æ›´æ–°ã€‚
- **List**ï¼šæ¶ˆæ¯é˜Ÿåˆ—ã€æœ€æ–° N æ¡è®°å½•çš„é¦–é€‰ã€‚`LPUSH + RPOP` å®ç°ç”Ÿäº§æ¶ˆè´¹æ¨¡å‹ï¼Œ`LTRIM` æ§åˆ¶é•¿åº¦é˜²å†…å­˜æº¢å‡ºã€‚
- **Set**ï¼šå»é‡ä¸é›†åˆè¿ç®—åˆ©å™¨ã€‚ç¤¾äº¤å…³ç³»â€œå…±åŒå¥½å‹â€ã€â€œæ ‡ç­¾äº¤é›†â€ç­‰åœºæ™¯ä¿¡æ‰‹æ‹ˆæ¥ã€‚
- **Sorted Set**ï¼šå¸¦æƒé‡çš„æ’è¡Œæ¦œã€å»¶è¿Ÿé˜Ÿåˆ—çš„æ ¸å¿ƒã€‚`ZRANGEBYSCORE` å¯å®ç°æ—¶é—´çª—å£æ»‘åŠ¨ï¼Œæ”¯æ’‘å®æ—¶çƒ­æ¦œã€‚

> æŒæ¡å‘½ä»¤åªæ˜¯ç¬¬ä¸€æ­¥ï¼Œç†è§£â€œä½•æ—¶è¯¥ç”¨å“ªç§ç»“æ„â€æ‰æ˜¯æ¶æ„æ€ç»´çš„ä½“ç°ã€‚ä¾‹å¦‚ï¼šç”¨ Hash å­˜å‚¨å¯¹è±¡æ¯”ç”¨å¤šä¸ª String æ›´çœå†…å­˜ï¼›ç”¨ ZSet åšæ’è¡Œæ¦œæ¯”è‡ªå·±æ’åºé«˜æ•ˆç™¾å€ã€‚


---


### äºŒã€å†…å­˜æ¨¡å‹ä¸æŒä¹…åŒ–ï¼šç¨³å®šæ€§çš„å‘½è„‰æ‰€åœ¨

å¾ˆå¤šå¼€å‘è€…åªå…³æ³¨ API è°ƒç”¨ï¼Œå´å¿½è§†äº† Redis æ˜¯â€œå†…å­˜æ•°æ®åº“â€è¿™ä¸€æœ¬è´¨ã€‚å†…å­˜åˆ†é…ç­–ç•¥ã€æ·˜æ±°æœºåˆ¶ã€æŒä¹…åŒ–æ–¹å¼ï¼Œç›´æ¥å†³å®šä½ çš„æœåŠ¡èƒ½å¦æ‰›ä½æµé‡æ´ªå³°ã€‚

- **å†…å­˜æ¨¡å‹**ï¼šRedis ä½¿ç”¨ slab åˆ†é…å™¨ç®¡ç†å†…å­˜ï¼Œä¸åŒæ•°æ®ç»“æ„æœ‰ä¸åŒå†…å­˜å¼€é”€ã€‚ä¸€ä¸ª Hash ä¸­å­˜ 100 ä¸ªå­—æ®µï¼Œå¯èƒ½æ¯” 100 ä¸ªç‹¬ç«‹ String èŠ‚çœ 40% å†…å­˜ã€‚
- **æ·˜æ±°ç­–ç•¥**ï¼š`volatile-lru`ã€`allkeys-lfu` ç­‰ç­–ç•¥éœ€æ ¹æ®ä¸šåŠ¡é€‰æ‹©ã€‚ç”µå•†å¤§ä¿ƒæœŸé—´è‹¥æœªåˆç†é…ç½®ï¼Œå¯èƒ½å¯¼è‡´çƒ­ç‚¹å•†å“ç¼“å­˜è¢«è¯¯åˆ ã€‚
- **æŒä¹…åŒ–æœºåˆ¶**ï¼š
  - `RDB` å¿«ç…§ï¼šæ¢å¤å¿«ã€æ–‡ä»¶å°ï¼Œä½†å¯èƒ½ä¸¢æœ€è¿‘æ•°æ®ã€‚
  - `AOF` æ—¥å¿—ï¼šæ•°æ®å®‰å…¨é«˜ï¼Œä½†æ–‡ä»¶å¤§ã€æ¢å¤æ…¢ã€‚
  - ç”Ÿäº§ç¯å¢ƒæ¨è `AOF + RDB æ··åˆæ¨¡å¼`ï¼Œå…¼é¡¾å®‰å…¨ä¸æ•ˆç‡ã€‚

> âš ï¸ æ³¨æ„: ä¸è¦ç­‰åˆ° OOM æ‰æƒ³èµ·å†…å­˜ä¼˜åŒ–ã€‚å®šæœŸä½¿ç”¨ `MEMORY USAGE key` å’Œ `INFO memory` ç›‘æ§å†…å­˜æ°´ä½ï¼Œè®¾ç½®åˆç†çš„ `maxmemory` å’Œæ·˜æ±°ç­–ç•¥ã€‚


---


### ä¸‰ã€è¿›é˜¶æŠ€èƒ½æ ‘ï¼šä»å•æœºèµ°å‘åˆ†å¸ƒå¼æ¶æ„

å½“ä½ ç†Ÿç»ƒé©¾é©­å•æœº Redis åï¼ŒçœŸæ­£çš„æŒ‘æˆ˜æ‰åˆšåˆšå¼€å§‹ã€‚ä»¥ä¸‹æ˜¯ä¸‰æ¡å…³é”®è¿›é˜¶è·¯çº¿ï¼š

1. **Redis é›†ç¾¤ï¼ˆClusterï¼‰**  
   å­¦ä¹ åˆ†ç‰‡åŸç†ã€æ§½ä½åˆ†é…ã€æ•…éšœè½¬ç§»æœºåˆ¶ã€‚æŒæ¡ `redis-cli --cluster create` æ­å»ºé›†ç¾¤ï¼Œç†è§£ MOVED/ASK é‡å®šå‘èƒŒåçš„è·¯ç”±é€»è¾‘ã€‚

2. **Pipeline ä¸æ‰¹é‡æ“ä½œ**  
   å‡å°‘ç½‘ç»œå¾€è¿”ï¼Œæå‡ååé‡ã€‚ä¸€æ¬¡ Pipeline å¯æ‰“åŒ…æ•°ç™¾æ¡å‘½ä»¤ï¼Œæ€§èƒ½æå‡å¯è¾¾ 5-10 å€ã€‚å°¤å…¶é€‚ç”¨äºæ—¥å¿—å†™å…¥ã€æ‰¹é‡åˆå§‹åŒ–ç­‰åœºæ™¯ã€‚

3. **Lua è„šæœ¬å®ç°åŸå­å¤åˆæ“ä½œ**  
   ç”¨ EVAL å°è£…å¤šæ­¥é€»è¾‘ï¼Œä¿è¯åŸå­æ€§ã€‚æ¯”å¦‚â€œæ‰£åº“å­˜+è®°å½•æµæ°´â€å¿…é¡»åŒæ—¶æˆåŠŸï¼ŒLua è„šæœ¬èƒ½é¿å…ç«æ€æ¡ä»¶ï¼Œæ›¿ä»£éƒ¨åˆ†äº‹åŠ¡éœ€æ±‚ã€‚

```python
def example_function(param):
    """
    å‡½æ•°ç”¨é€”è¯´æ˜
    
    Args:
        param: å‚æ•°è¯´æ˜
    
    Returns:
        è¿”å›å€¼è¯´æ˜
    """
    # Step 1: ç¬¬ä¸€æ­¥æ“ä½œè¯´æ˜
    result_1 = do_something(param)
    
    # Step 2: ç¬¬äºŒæ­¥æ“ä½œè¯´æ˜  
    result_2 = do_another_thing(result_1)
    
    # Step 3: è¿”å›ç»“æœ
    return result_2
```

#### OUTPUT

```
æ¨¡æ‹Ÿè¾“å‡ºç»“æœ
```

ä»£ç è§£é‡Šæ®µè½ (1-2æ®µï¼Œè§£é‡Šä»£ç çš„å…³é”®ç‚¹)


---


### å››ã€ç›‘æ§ä¸è°ƒä¼˜ï¼šè®©æ€§èƒ½ç“¶é¢ˆæ— æ‰€éå½¢

å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ã€‚æ¨èä¸¤æ¬¾åˆ©å™¨åŠ©ä½ æŒæ§å…¨å±€ï¼š

- **RedisInsight**ï¼šå®˜æ–¹å¯è§†åŒ–ç›‘æ§å¹³å°ï¼Œå®æ—¶æŸ¥çœ‹å†…å­˜ã€OPSã€æ…¢æŸ¥è¯¢ã€å®¢æˆ·ç«¯è¿æ¥ç­‰æŒ‡æ ‡ï¼Œæ”¯æŒæ‹“æ‰‘å›¾å’Œå‘½ä»¤åˆ†æã€‚
- **æ€§èƒ½è°ƒä¼˜æ–¹å‘**ï¼š
  - è¯†åˆ«æ…¢æŸ¥è¯¢ï¼š`SLOWLOG GET 10`
  - ä¼˜åŒ– Key è®¾è®¡ï¼šé¿å…é•¿ Keyã€å¤§ Value
  - åˆç†ä½¿ç”¨è¿æ¥æ± ï¼Œé¿å…é¢‘ç¹åˆ›å»ºé”€æ¯è¿æ¥
  - ç›‘æ§ç½‘ç»œå»¶è¿Ÿä¸ CPU ä½¿ç”¨ç‡ï¼Œæ’æŸ¥ç“¶é¢ˆæ ¹æº

> ä»Šå¤©çš„å®æˆ˜æ˜¯æ˜å¤©æ¶æ„è®¾è®¡çš„åŸºçŸ³ â€”â€” åˆ«åœï¼Œç»§ç»­æ·±å…¥ Redis çš„ä¸–ç•Œã€‚ä½ å·²èµ°è¿‡äº†ä»å…¥é—¨åˆ°å®æˆ˜çš„å…³é”®é˜¶æ®µï¼Œæ¥ä¸‹æ¥ï¼Œè¯·å‹‡æ•¢è¸å…¥é›†ç¾¤ã€è„šæœ¬ã€é«˜å¯ç”¨çš„ä¸–ç•Œï¼Œé‚£é‡Œæœ‰æ›´å¹¿é˜”çš„æ¶æ„èˆå°ç­‰ä½ æŒ¥æ´’ã€‚


---


æŠ€æœ¯ä¹‹è·¯æ²¡æœ‰ç»ˆç‚¹ï¼Œä½†æ¯ä¸€æ­¥éƒ½ç®—æ•°ã€‚æ„¿ä½ åœ¨ Redis çš„æ˜Ÿè¾°å¤§æµ·ä¸­ï¼Œä¸æ­¢äºç¼“å­˜ï¼Œä¸æ­¢äºé€Ÿåº¦ï¼Œè€Œæ˜¯æˆé•¿ä¸ºèƒ½è®¾è®¡ã€èƒ½è°ƒä¼˜ã€èƒ½æ•‘ç«çš„å…¨æ ˆå­˜å‚¨ä¸“å®¶ã€‚

---


## æ€»ç»“

- Redis æ˜¯å†…å­˜ä¼˜å…ˆçš„å¤šç”¨é€”æ•°æ®ç»“æ„æœåŠ¡å™¨ï¼Œé€‚ç”¨äºé«˜é€Ÿè¯»å†™åœºæ™¯
- æŒæ¡ String/Hash/List/Set/ZSet äº”å¤§ç»“æ„å³å¯åº”å¯¹å¤šæ•°ä¸šåŠ¡éœ€æ±‚
- é€šè¿‡ CLI å®æˆ˜åŠ æ·±ç†è§£ï¼Œç»“åˆçœŸå®åœºæ™¯éªŒè¯å‘½ä»¤ç»„åˆæ•ˆæœ
- ä¸‹ä¸€æ­¥å»ºè®®æ¢ç´¢é›†ç¾¤éƒ¨ç½²ã€äº‹åŠ¡æ§åˆ¶ä¸æ€§èƒ½ç›‘æ§

## å»¶ä¼¸é˜…è¯»

æ¨èé˜…è¯»ã€ŠRedis è®¾è®¡ä¸å®ç°ã€‹æˆ–å®˜æ–¹æ–‡æ¡£ä¸­çš„ Persistence ä¸ Replication ç« èŠ‚ï¼Œå°è¯•æ­å»ºä¸»ä»å¤åˆ¶ç¯å¢ƒã€‚

## å‚è€ƒèµ„æ–™

### ğŸŒ ç½‘ç»œæ¥æº

1. https://redis.io/docs/
2. https://github.com/redis/redis
3. https://redis.io/docs/data-types/
4. https://hub.docker.com/_/redis
